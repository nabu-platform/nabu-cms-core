<sequence xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" disabled="false" id="4361bb5d-9a7d-4e0b-a9b7-21e5c673befa">
	<steps xsi:type="be.nabu.libs.services.vm.step.Map" disabled="false" comment="Set default" id="e82a28ac-9e1b-45d7-aa7f-0a1683fb9f65">
		<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="d1d77bd4-5790-44c5-bd1f-e30ba3e3cb39" optional="true" mask="false" fixedValue="true">
			<from>true</from>
			<to>input/rethrow</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Sequence" disabled="false" id="0091e20a-74fa-45f4-8d03-b61fd8dae055" transactionVariable="transactionId">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map" disabled="false" comment="Get exception summary and audit level" id="4b87fa08-74cb-45f1-9134-a4734c3cf865">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke" disabled="false" id="1120e9a4-7852-4fc0-afe6-583b0cfe3417" invocationOrder="0" temporaryMapping="true" serviceId="nabu.utils.Runtime.summarizeException" resultName="resultacdcc61e48d24696b18b26f13293d843" y="117" x="166">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="b2149e77-c7a7-41e9-832e-f28cada9c8d8" optional="false" mask="false" fixedValue="false">
					<from>input/exception</from>
					<to>exception</to>
				</steps>
				<asynchronous>false</asynchronous>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="7bff24f3-0059-41d5-a503-3bbd1ab56f0c" optional="false" mask="false" fixedValue="false">
				<from>resultacdcc61e48d24696b18b26f13293d843/summary</from>
				<to>summary</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke" disabled="false" id="be23e7fe-f895-4408-813d-90e8dfee3af8" invocationOrder="0" temporaryMapping="true" serviceId="nabu.cms.core.database.masterdata.entry.selectByCategoryAndName" resultName="result3264b12ddce64be0b9b5f2afc3b13bf8" y="210" x="90">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="8e11ef34-1e2f-4abe-853b-7b1a6d9ecd1d" optional="false" mask="false" fixedValue="false">
					<from>input/connectionId</from>
					<to>connection</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="84f0f11c-036c-45ad-8e32-cc20bda2f97f" optional="false" mask="false" fixedValue="false">
					<from>transactionId</from>
					<to>transaction</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="c31a7211-82b4-434e-86d8-e3aa52e62ac9" optional="false" mask="false" fixedValue="true">
					<from>error</from>
					<to>parameters/name</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="4c9dc068-8222-402a-b88d-313d18fa7b6a" optional="false" mask="false" fixedValue="true">
					<from>auditLevel</from>
					<to>parameters/category</to>
				</steps>
				<asynchronous>false</asynchronous>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="a2029ee3-0c93-415d-9737-6a2021f0f8bb" optional="false" mask="false" fixedValue="false">
				<from>result3264b12ddce64be0b9b5f2afc3b13bf8/results[0]</from>
				<to>auditLevel</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Switch" disabled="false" id="2de0b7e8-42b8-40a9-bac3-4e0a1a0f4700" query="auditLevel">
			<steps xsi:type="be.nabu.libs.services.vm.step.Throw" disabled="false" label="null" id="cd370f16-c103-4644-800f-78b7cbd1d91d" message="Can not find audit level 'error'" xsi:nil="true"/>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map" disabled="false" comment="Update audit log" id="7266dd84-d406-4547-8e31-6e4d2858cc51">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke" disabled="false" id="8ffa4993-92b1-4676-8c6d-d59df0ebba22" invocationOrder="1" temporaryMapping="true" serviceId="nabu.cms.core.database.node.audit.update" resultName="resultb74057c86c404ed2a05c787b371c76dd" y="46" x="343">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="1bd201e4-2957-4fd0-8bc0-6cf1bf6cbeee" optional="false" mask="false" fixedValue="false">
					<from>input/connectionId</from>
					<to>connection</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="7d4c97b6-b98e-41ac-a303-05c8e8e3e251" optional="false" mask="false" fixedValue="false">
					<from>input/auditId</from>
					<to>parameters[0]/id</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="c50a4297-dd7c-4759-b138-e27d9cdd37ea" optional="false" mask="false" fixedValue="false">
					<from>result75cce59e78a84d3eb67d0010570c9f4f/date</from>
					<to>parameters[0]/modified</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="3365d1ab-166d-4465-8e48-35bc14c0ce30" optional="false" mask="false" fixedValue="false">
					<from>summary/code</from>
					<to>parameters[0]/errorCode</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="69411d80-ec25-475e-a998-5084cd532ff9" optional="false" mask="false" fixedValue="true">
					<from>="Message: " + message + "\n" + "Service stack: " + summary/serviceStack + "\n" + "Exception stack: " + summary/exceptionStack</from>
					<to>parameters[0]/errorLog</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="0e8bf87d-72ea-411c-a5ef-433270bf827c" optional="false" mask="false" fixedValue="false">
					<from>auditLevel/id</from>
					<to>parameters[0]/auditLevelId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="3ec4bc49-109e-49da-bdf1-2fc4cdb79182" optional="false" mask="false" fixedValue="false">
					<from>transactionId</from>
					<to>transaction</to>
				</steps>
				<asynchronous>false</asynchronous>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke" disabled="false" id="fbd48f1c-4966-4659-a35f-4fe78a2f38af" invocationOrder="0" temporaryMapping="true" serviceId="nabu.utils.Date.now" resultName="result75cce59e78a84d3eb67d0010570c9f4f" y="274" x="14">
				<asynchronous>false</asynchronous>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke" disabled="false" id="63dca8ba-a698-4dfc-ad26-7f36950dad5d" invocationOrder="0" temporaryMapping="true" serviceId="nabu.utils.Transaction.rollback" resultName="result0d84018d11384f12b7235d68d961eeee" y="266" x="364">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="e2302c33-c8d4-4f9a-b915-da0c87bb860f" optional="false" mask="false" fixedValue="false">
					<from>input/auditId</from>
					<to>transactionId</to>
				</steps>
				<asynchronous>false</asynchronous>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Switch" disabled="false" id="07089b8a-6f8d-493d-b3a6-18da8b21b592" query="input/rethrow">
		<steps xsi:type="be.nabu.libs.services.vm.step.Throw" disabled="false" label="true" id="016e3db6-e13b-4615-8782-9aac1d571dae" message="=input/exception" xsi:nil="true"/>
	</steps>
</sequence>