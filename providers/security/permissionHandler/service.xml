<sequence xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		disabled="false"
		id="fdbdcdd3-19be-451a-9237-5d51e9ddf3f9"
		lineNumber="1">
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Set false as default"
			disabled="false"
			id="2a466dd2-f9c1-4c5a-9551-63f4e14dfffc"
			lineNumber="2">
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="721be24e-cc63-4d3e-a122-8d3bf21f874a"
				mask="false"
				optional="false"
				fixedValue="true">
			<from>false</from>
			<to>output/response</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Get all the actions that match by name"
			disabled="false"
			id="2ff34e00-5c0e-4870-8f07-904d148a75ce"
			lineNumber="3">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="4a3a5fd3-b547-4ee7-ac76-387d6404d244"
				serviceId="nabu.cms.core.crud.action.services.list"
				resultName="result6ed5799ae0ab4b69a1cefe4a459c4e84"
				temporaryMapping="true"
				x="102"
				y="41"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="85b9e738-f19e-4119-981a-1e4a08993c94"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/configuration/connectionId</from>
				<to>connectionId</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="0a93c75d-ef5e-426e-bca7-34a0909b0eb2"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/action</from>
				<to>filter/name[0]</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="b3a5b624-4411-454c-85b8-cbedcbffcf61"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result6ed5799ae0ab4b69a1cefe4a459c4e84/results</from>
			<to>potentialActions</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
			comment="If we have a context, we must resolve the node"
			disabled="false"
			id="e013fd93-7219-4612-8863-4a174fdce1c2"
			label="input/context != null"
			lineNumber="4">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				disabled="false"
				id="59d5092c-c764-4600-b1c4-497abfb16327"
				lineNumber="5">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="bb69aad0-96e5-413e-abef-a47be8cf55d3"
					serviceId="nabu.cms.core.utils.security.resolveNode"
					resultName="resultf7872d5ce375423e93ec38917b5c0544"
					temporaryMapping="true"
					x="82"
					y="25"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="d82b7b9d-9ca3-4bc0-bc00-aa1cb2b73364"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/configuration/connectionId</from>
					<to>connectionId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="bd3c420f-5e94-4b7e-a91e-e4ee7683b43b"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/context</from>
					<to>context</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="c36fea9a-6c0c-4f0f-bb19-6f0d80e9b3e5"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/configuration/allowDisabledNodes</from>
					<to>allowDisabledNodes</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="247c5189-8a6e-4714-8399-2db1334feb6c"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/configuration</from>
					<to>configuration</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="8e8ac8ae-0d0e-4ffa-bd2e-6ec68f57de08"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>resultf7872d5ce375423e93ec38917b5c0544/node</from>
				<to>node</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Throw"
				description="=&quot;Security context could not be resolved: &quot; + input/context"
				disabled="false"
				id="45eeba61-9181-4719-85c0-7bcfaf185390"
				label="!node"
				lineNumber="6"
				message="Security context could not be resolved"
				whitelist="false" xsi:nil="true"/>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Only retain action that pertain to no particular component OR this specific component"
				disabled="false"
				id="299bf688-8acf-4d87-aa53-952280ac4b42"
				lineNumber="7">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="f22a1a33-fc87-4496-a68b-6e4ddc1954b2"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>potentialActions[componentId == null || componentId == /node/componentId]</from>
				<to>potentialActions</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Get the node ids in the path"
				disabled="false"
				id="e09dea2b-92a0-4d53-8a8b-9d17835e1e85"
				lineNumber="8">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="f7546c83-65e3-4916-848a-55bdba24dab8"
					serviceId="nabu.utils.String.split"
					resultName="result9dd8b3c950e447028bedeb49a935a2a6"
					temporaryMapping="true"
					x="85"
					y="78"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="6d53ab21-eb3d-4e2d-a097-9b6d8840d9ba"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>node/path</from>
					<to>string</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="91ae8d3c-8a90-4ad8-977c-c256760b1732"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>/</from>
					<to>separator</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="2b8eb58d-d40b-4c9d-ab84-eaa4bd8cc623"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result9dd8b3c950e447028bedeb49a935a2a6/parts</from>
				<to>nodeIds</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Get connected nodes"
				disabled="false"
				id="ab2cf2f1-8989-414b-9e0c-ef27be9380b4"
				label="nodeIds != null"
				lineNumber="9">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="71223edb-059f-4646-8392-46bdbb0bb02c"
					serviceId="nabu.cms.core.database.node.connection.selectByTargetIds"
					resultName="result2eb67b57f03b4426826b716e885a0b7c"
					temporaryMapping="true"
					x="60"
					y="86"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="4181da00-7888-4896-96d4-c02587a35d71"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>nodeIds</from>
					<to>parameters/targetIds</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="8385cc18-4056-4f85-b74c-8e362b12106d"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/configuration/connectionId</from>
					<to>connection</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="ee91a549-4afa-48bc-a47d-fff9d0e857b2"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result2eb67b57f03b4426826b716e885a0b7c/results/sourceId</from>
				<to>connectedNodeIds</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Retain actions that are not linked to a specific owner OR linked to a node in the path"
				disabled="false"
				id="1db4b5fe-7045-4750-84a6-7e459922ae6d"
				lineNumber="10">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="a22e96b4-98bf-4ec5-8ab9-413287ededd1"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>potentialActions[ownerId == null || ownerId # /nodeIds || ownerId # /connectedNodeIds]</from>
				<to>potentialActions</to>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="d4966088-3546-4d7c-b5f8-809b6dc7aca2"
			lineNumber="11">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="8649e92c-397b-4d86-8aaa-4ee5ce351912"
				serviceId="nabu.utils.List.size"
				resultName="result756eb5fbed4b4567b9c58d3c029e7e4f"
				temporaryMapping="true"
				x="56"
				y="191"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="4f826aa6-2224-4185-afdf-e36d87e0ea9a"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>potentialActions</from>
				<to>list</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="6394e26e-3697-4293-b545-a8019512240a"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result756eb5fbed4b4567b9c58d3c029e7e4f/size</from>
			<to>amountOfPotentialActions</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Throw"
			description="=&quot;No applicable actions found for &quot; + input/action + &quot; in context &quot; + input/context"
			disabled="true"
			id="3a98ec4df00f4758bd2125bd1ed7e1d3"
			label="amountOfPotentialActions == 0"
			lineNumber="12"
			code="403"
			message="No applicable actions found"
			whitelist="false" xsi:nil="true"/>
	<steps xsi:type="be.nabu.libs.services.vm.step.Break"
			comment="We don't fail hard, we just return false"
			disabled="false"
			id="6308bb46-0021-4a56-a0bc-ab70cafe7b67"
			label="amountOfPotentialActions == 0"
			lineNumber="13">
		<count>1</count>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
			comment="Get the user (if any)"
			disabled="false"
			id="4d23a568-f644-4a66-942f-862999d86bd2"
			lineNumber="14">
		<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
				disabled="false"
				id="cf8e1fbc-420d-4262-99d4-44e283cc98d2"
				label="input/token != null"
				lineNumber="15">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					disabled="false"
					id="45430adb-dad1-45ee-8ed7-475144aaa2ab"
					lineNumber="16">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="3e13ddf1-bf6f-4d8c-a14a-5f635d3e0cb1"
						serviceId="nabu.cms.core.database.user.selectActiveByAlias"
						resultName="result2129e08ddde64d2db97a7473c21df295"
						temporaryMapping="true"
						x="512"
						y="75"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="9baf6565-0ecb-443e-a29c-aa4baaea5b7f"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/token/name</from>
						<to>parameters/alias</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="baf00967-bc2b-46a5-b15e-8c2a50fec24e"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/token/realm</from>
						<to>parameters/realm</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="4352aa70-51cc-41e4-89f1-872b00836c93"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/configuration/connectionId</from>
						<to>connection</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="3eb070d1-e1c3-4d12-9b9f-d5fb44c03efa"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/configuration/caseInsensitive</from>
						<to>parameters/caseInsensitive</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="849140c9-5d30-4d89-b219-1b5a38121116"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result2129e08ddde64d2db97a7473c21df295/results[0]</from>
					<to>user</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="a9647b374ea243d4a73c7385406e048e"
						fixedValue="false">
					<from>result2129e08ddde64d2db97a7473c21df295/rowCount</from>
					<to>rowCount</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Throw"
					description="=&quot;Multiple users found that match: &quot; + input/token/name + &quot; @ &quot; + input/token/realm"
					disabled="false"
					id="802ac627fcd643b98e66894fd7619abe"
					label="rowCount &gt;= 2"
					lineNumber="17"
					message="Multiple users found that match"
					alias="=input/token/name"
					realm="=input/token/realm"
					authenticationId="=input/token/authenticationId"
					whitelist="false" xsi:nil="true"/>
			<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
					disabled="false"
					id="b3f9e0c3-5ad7-44c3-a197-7f43d91419e6"
					lineNumber="18"
					query="user">
				<steps xsi:type="be.nabu.libs.services.vm.step.Throw"
						description="=&quot;Invalid user: &quot; + input/token/name"
						disabled="false"
						id="f0befec2-3ed1-4216-b489-292f26c86dac"
						label="null"
						lineNumber="19"
						message="Invalid user"
						alias="=input/token/name"
						realm="=input/token/realm"
						whitelist="false" xsi:nil="true"/>
				<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
						disabled="false"
						id="adf85499-7d55-46ab-ae70-4b826d4b38a8"
						lineNumber="20">
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							disabled="false"
							id="1d6c2423-c1a4-4312-b271-844aa5678bfc"
							lineNumber="21">
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="1bacf204-436f-4e2e-b9b0-9e5d6c4bd694"
								serviceId="nabu.cms.core.database.user.selectGroupRoles"
								resultName="result8b111a583a024dc0bd57254581506683"
								temporaryMapping="true"
								x="91"
								y="172"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="7f83107e-783f-4a86-9ed2-243f5243c47c"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>input/configuration/connectionId</from>
								<to>connection</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="85bc39a0-2eb1-4668-b748-94093d0bc3d7"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>user/id</from>
								<to>parameters/userId</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="afa208ea-33c0-4e17-a45b-9f7b41938fd9"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>result8b111a583a024dc0bd57254581506683/results</from>
							<to>groupRoles</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							comment="Through connections you can inherit permissions granted to another user."
							disabled="false"
							id="31e42add-c173-4b10-a3a4-98611bae1b78"
							lineNumber="22">
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="85e3714c-6ec6-4d60-9073-87935fc8ba28"
								serviceId="nabu.cms.core.database.user.selectConnectedGroupRoles"
								resultName="resulta16c73c56b34456cbb6ef4d3ecf2d9ca"
								temporaryMapping="true"
								x="56"
								y="86"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="b6588985-349a-4796-af03-42e732c3b56c"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>input/configuration/connectionId</from>
								<to>connection</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="daaba6a2-6514-4be9-89c8-4303e46701ad"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>user/id</from>
								<to>parameters/userId</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="8d783a1b-7377-42ac-b5e8-51f3579e967a"
								serviceId="nabu.utils.List.addAll"
								resultName="resultaa2ae06ad74f47e681e752773bbcec3a"
								temporaryMapping="true"
								x="526"
								y="206"
								invocationOrder="1"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="8464e3d8-9c96-4293-a7d8-cf54fd663d19"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>groupRoles</from>
								<to>list</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="6fdbcbea-92a7-4dee-a1f7-147cc5bfc3d9"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>resulta16c73c56b34456cbb6ef4d3ecf2d9ca/results</from>
								<to>objects</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="af1e4d47-f5d0-40c8-816c-3af53b85fdf0"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>resultaa2ae06ad74f47e681e752773bbcec3a/list</from>
							<to>groupRoles</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
							disabled="false"
							id="b51c6c8f-f5a8-42d8-8eb1-945fefbbc395"
							lineNumber="23"
							query="node">
						<steps xsi:type="be.nabu.libs.services.vm.step.Map"
								comment="Retain only the group roles that have no context"
								disabled="false"
								id="eecd62d4-0cf2-4a1a-8c21-699bd1535c1d"
								label="null"
								lineNumber="24">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="c82e5b37-df37-491a-b6f2-27233dd70cb0"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>groupRoles[nodeId == null]</from>
								<to>activeGroupRoles</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
									disabled="false"
									id="f6a42129-5fcc-41f7-a2cf-4161c6dc31cf"
									path="groupRoles" xsi:nil="true"/>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
								disabled="false"
								id="fec68b5d-d91f-49af-8888-30cfa23aa1de"
								lineNumber="25">
							<steps xsi:type="be.nabu.libs.services.vm.step.Map"
									comment="Get the parent ids"
									disabled="false"
									id="2134fc5db8144d37ad1ede3d93323a9d"
									lineNumber="26">
								<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
										disabled="false"
										id="9b342cb15cb04fda983bfe2896ba7b73"
										serviceId="nabu.utils.String.split"
										resultName="result9dd8b3c950e447028bedeb49a935a2a6"
										temporaryMapping="true"
										x="85"
										y="78"
										invocationOrder="0"
										asynchronous="false"
										recache="false">
									<steps xsi:type="be.nabu.libs.services.vm.step.Link"
											disabled="false"
											id="73bd56e9603f4975b0952c46247b56b5"
											mask="false"
											optional="false"
											fixedValue="false">
										<from>node/path</from>
										<to>string</to>
									</steps>
									<steps xsi:type="be.nabu.libs.services.vm.step.Link"
											disabled="false"
											id="28ac99b1dac54a918d47ef5de6c26153"
											mask="false"
											optional="false"
											fixedValue="true">
										<from>/</from>
										<to>separator</to>
									</steps>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="7bf9741cc5c342bf8e8401492e1c48ef"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>result9dd8b3c950e447028bedeb49a935a2a6/parts</from>
									<to>nodeIds</to>
								</steps>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Map"
									comment="Get connected nodes"
									disabled="false"
									id="d44987578156411489666024b702d03a"
									label="nodeIds != null"
									lineNumber="27">
								<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
										disabled="false"
										id="8632db5cf81b45b69b298c44c87e1835"
										serviceId="nabu.cms.core.database.node.connection.selectByTargetIds"
										resultName="result2eb67b57f03b4426826b716e885a0b7c"
										temporaryMapping="true"
										x="60"
										y="86"
										invocationOrder="0"
										asynchronous="false"
										recache="false">
									<steps xsi:type="be.nabu.libs.services.vm.step.Link"
											disabled="false"
											id="1097203e66e041a0ab602d56776c724d"
											mask="false"
											optional="false"
											fixedValue="false">
										<from>nodeIds</from>
										<to>parameters/targetIds</to>
									</steps>
									<steps xsi:type="be.nabu.libs.services.vm.step.Link"
											disabled="false"
											id="68db3cfa6b3144c8b4eb87f0e38b828d"
											mask="false"
											optional="false"
											fixedValue="false">
										<from>input/configuration/connectionId</from>
										<to>connection</to>
									</steps>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="2aac2cddc8c0464db4d2cc94d8d1a983"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>result2eb67b57f03b4426826b716e885a0b7c/results/sourceId</from>
									<to>connectedNodeIds</to>
								</steps>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Map"
									comment="Retain the roles with no context or an applicable context"
									disabled="false"
									id="09b2944e-187a-4fa7-8f10-4fb19ae6e8a6"
									lineNumber="28">
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="1429049f-6f4f-4f3a-8de4-a2ce8fd571e6"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>groupRoles[nodeId == null || nodeId == /node/id || (nodeId # /nodeIds &amp;&amp; inherit) || (nodeId # /connectedNodeIds)]</from>
									<to>activeGroupRoles</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
										disabled="false"
										id="f3d35eb3-c567-4751-99cd-37b01e28b42d"
										path="groupRoles" xsi:nil="true"/>
							</steps>
						</steps>
					</steps>
				</steps>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="627bf315fbff47039de643ecc801b507"
			label="input/configuration/roleProviderId != null"
			lineNumber="29">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="730fcd245e224855be80d4bb920eada1"
				serviceId="nabu.cms.core.interfaces.roleProvider"
				resultName="result60526cdac6434393a2948e6ab919e53c"
				temporaryMapping="true"
				x="506"
				y="56"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="8f633097700a4990844243cd89430c9d"
					fixedValue="false">
				<from>user/id</from>
				<to>userId</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="d3c46b57811c49d08c3d6afa56a158c9"
					fixedValue="false">
				<from>nodeIds</from>
				<to>nodeIds</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="76a9bb129e504993a1a58bbe38b2ddd4"
					fixedValue="false">
				<from>input/configuration/roleProviderId</from>
				<to>implementationId</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="1431a6d6ec524593bd882da57d0cfdb6"
				fixedValue="false">
			<from>result60526cdac6434393a2948e6ab919e53c/roleIds</from>
			<to>customActiveRoleIds</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Get all the action roles that are not context-bound"
			disabled="false"
			id="0e00835d-75b6-49b4-8137-f1bfa952e9a4"
			lineNumber="30">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="d4e8392e-bbeb-46dd-90e7-6c505461e3f7"
				serviceId="nabu.cms.core.database.action.role.selectRolesByAction"
				resultName="result1b365de26254478d8313821e14b1ad96"
				temporaryMapping="true"
				x="68"
				y="64"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="69121d95-8701-49e1-86b2-3129c0de4a1d"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/configuration/connectionId</from>
				<to>connection</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="3f8ffc9e-7e39-4bac-b918-926fe8efd90f"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>potentialActions/id</from>
				<to>parameters/actionId</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="8de52d40-1260-49ca-91dc-38d26b4f41fb"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result1b365de26254478d8313821e14b1ad96/results[pseudo == true]</from>
			<to>pseudoRoles</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="08711743-c6c2-4564-912d-4ff2dd1eb2b0"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result1b365de26254478d8313821e14b1ad96/results[pseudo == false &amp;&amp; (id # /activeGroupRoles/roleId || id # /customActiveRoleIds)]</from>
			<to>activeRoles</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Get amount of active roles"
			disabled="false"
			id="7a13798c-8ec8-44da-a423-b98c09d573fc"
			lineNumber="31">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="8517e620-3b78-474b-983c-28715dd008b0"
				serviceId="nabu.utils.List.size"
				resultName="result027828eeb195404bac6fe62d95e626e4"
				temporaryMapping="true"
				x="198"
				y="75"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="9a324dab-ff6d-4df2-895c-42fef496ef03"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>activeRoles</from>
				<to>list</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="ee41a0cc-2230-4c16-86ef-b8731ac2e063"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result027828eeb195404bac6fe62d95e626e4/size</from>
			<to>amountOfActiveRoles</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
			disabled="false"
			id="8d7b2188-07b1-47f5-b480-2e5c17e57cd4"
			lineNumber="32"
			query="amountOfActiveRoles">
		<steps xsi:type="be.nabu.libs.services.vm.step.For"
				comment="If the user does not have the role as such, check pseudo roles"
				disabled="false"
				id="94b624dc-f7ba-4d22-99e9-570f415b7cb4"
				label="0"
				lineNumber="33"
				variable="role">
			<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
					disabled="false"
					id="e13604c4-920b-4395-b675-cc481a4014d2"
					lineNumber="34"
					query="role/name">
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Anyone"
						disabled="false"
						id="f47db739-1e93-43c6-b7b2-1ff2bea235f8"
						label="&quot;$anyone&quot;"
						lineNumber="35">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="10125d9d-2ea4-4495-9463-a5c6eda50a7e"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>true</from>
						<to>output/response</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="The current user is the &quot;owner&quot; of the node, it does not work (yet?) with inheritance through node connections"
						disabled="false"
						id="dc95bf07-be82-46f1-902a-7cb7eb42f1f0"
						label="&quot;$owner&quot;"
						lineNumber="36">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="d26388ba-4ca9-47e6-a7e2-cb682569eaa9"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>=output/response || (node != null &amp;&amp; user != null &amp;&amp; user/id == node/ownerId)</from>
						<to>output/response</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="There is no current user"
						disabled="false"
						id="f9cb8789-89c2-43f7-bdf6-a180cc586747"
						label="&quot;$guest&quot;"
						lineNumber="37">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="afdb20ad-51da-4e49-a057-d0a8cf4e6256"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>=output/response || input/token == null</from>
						<to>output/response</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="There is _a_ user"
						disabled="false"
						id="12ab26e6-5b88-4335-945a-aca47e2f2ce4"
						label="&quot;$user&quot;"
						lineNumber="38">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="1d4a122d-7ea3-4297-93c8-d7516c8953c7"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>=output/response || user != null</from>
						<to>output/response</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
						disabled="false"
						id="453c2734-9ce5-4bb8-af8b-803be7365051"
						lineNumber="39"
						query="input/configuration/implementations/hasPseudoRole">
					<steps xsi:type="be.nabu.libs.services.vm.step.Throw"
							disabled="false"
							id="6797902e-5196-4df9-862d-0d3be6126a68"
							label="null"
							lineNumber="40"
							message="=&quot;Unknown pseudo role: &quot; + role/name"
							alias="=user/alias"
							realm="=user/realm"
							whitelist="false" xsi:nil="true"/>
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							disabled="false"
							id="31acf4c7-ed2e-4e5c-87f4-9a9b38e51abd"
							lineNumber="41">
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="b320584e-9a6a-4c61-8a70-1c935815cce6"
								serviceId="nabu.cms.core.interfaces.hasPseudoRole"
								resultName="result2469dbb25d2e4d518c1d73ad419945d6"
								temporaryMapping="true"
								x="70"
								y="95"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="25901635-0976-4571-9e07-29fdb7d9fdf6"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>role/name</from>
								<to>role</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="f0e12627-b5a5-49af-bbae-d2d47565a573"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>input/context</from>
								<to>context</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="e2865907-6122-4946-9bf2-926b903009a8"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>input/token</from>
								<to>token</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="abc5dd9e-1716-42c8-9db8-6ff48a19d288"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>input/configuration/implementations/hasPseudoRole</from>
								<to>implementationId</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="bde80d99-c393-4922-ae61-44e32504b5a5"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>node</from>
								<to>node</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="fcb0b120-c835-48bc-87a3-57de22594693"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>user</from>
								<to>user</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="e7f35dbd-0cfb-4f99-823b-14ddb891e0b1"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>result2469dbb25d2e4d518c1d73ad419945d6/hasRole</from>
							<to>output/response</to>
						</steps>
					</steps>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
					comment="Stop if the user already has the permission"
					disabled="false"
					id="81f876e7-6cfd-4fb8-992b-50755d837d03"
					lineNumber="42"
					query="output/response">
				<steps xsi:type="be.nabu.libs.services.vm.step.Break"
						disabled="false"
						id="b309b06b-2b7b-4323-98f2-406b0ae4bc20"
						label="true"
						lineNumber="43">
					<count>1</count>
				</steps>
			</steps>
			<query>pseudoRoles</query>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Set allowed"
				disabled="false"
				id="aebb76ec-9a05-43ef-9468-3830995d22ad"
				lineNumber="44">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="344b0607-64e4-40c2-a1bc-a42bc1e44c6f"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>true</from>
				<to>output/response</to>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
			comment="If you are not allowed and there is a configured permission handler, check that one as well"
			disabled="false"
			id="dffca8df-007d-4905-9ba1-44a5ac3099db"
			lineNumber="45">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				disabled="false"
				id="1d94e851-96e0-4d35-8899-f60fd6eebc3a"
				label="!output/response &amp;&amp; input/configuration/implementations/permissionHandler != null"
				lineNumber="46">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="d8adf3ae-48df-43c4-8a7f-e9add585ef4c"
					serviceId="nabu.cms.core.interfaces.permissionHandler"
					resultName="resultba408b839b5e4955bce77efcf58efd68"
					temporaryMapping="true"
					x="66"
					y="112"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="dc7f1653-c583-4976-b2f8-ff432ead0484"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/token</from>
					<to>token</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="44347678-f736-4004-842b-b94b8007e186"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/context</from>
					<to>context</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="74deeb47-93cd-4a1f-9628-b55441649c51"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/action</from>
					<to>action</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="ad1cefd3-9523-453c-a4ac-599de61de261"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/configuration</from>
					<to>configuration</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="fa895610-ba9c-48ab-9d08-38632840582a"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/configuration/implementations/permissionHandler</from>
					<to>implementationId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="1e87f787-8b22-48e5-9093-70b1c7ea044f"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>node</from>
					<to>node</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="465b58fb-4ed4-49e9-b5ba-6b4ce7362045"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>resultba408b839b5e4955bce77efcf58efd68/response</from>
				<to>output/response</to>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
			disabled="false"
			id="83ecd6df-d78f-4d66-90a7-119a84353c68"
			label="true # /potentialActions/audit"
			lineNumber="47">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				disabled="false"
				id="9c57d8ff-4743-4919-80af-73edcb828e49"
				label="output/response == false"
				lineNumber="48">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="012857bf-eddd-42b5-a000-e6d5e2ca599a"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>error</from>
				<to>auditLevel</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="3af617b8-ae35-4dd2-90cd-1db87c606ab9"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>403</from>
				<to>auditCode</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Start audit entry"
				disabled="false"
				id="17ae0771-949b-4517-bf71-b80eea9167b6"
				lineNumber="49">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="dea37095-b68d-4672-b9ab-e122e8cc8930"
					serviceId="nabu.cms.core.services.node.audit.create"
					resultName="resultad10368f8e5d43f28c70133354824e5d"
					temporaryMapping="true"
					x="391"
					y="85"
					invocationOrder="1"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="dbac2cda-d6ca-44f4-b7da-29051a4a090b"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/configuration/connectionId</from>
					<to>connectionId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="6d69c745-7897-41d8-83cb-1b0c4ab29b9a"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/action</from>
					<to>action</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="be46a079-7f20-423b-87df-2c35b2b9cc24"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>output/response</from>
					<to>inject</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="eeb94fac-4901-4bda-a05e-84455d4981b4"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>auditLevel</from>
					<to>level</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="9be949e6-7b3f-411a-8670-ab0146aafe9b"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>auditCode</from>
					<to>errorCode</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="cbead094-af49-46fa-88d8-5fe9a39da811"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/token</from>
					<to>token</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="574d443d-dc85-488f-8431-33b8dea1d980"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>resultc8e82c670eaf49e8b17bb10be1ef5a3e/device</from>
					<to>device</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="a0368a74-19ea-422f-989a-9364727ce86a"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>node/id</from>
					<to>nodeId</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="09c2f29f-8f2a-4602-9afd-0fe45e33da3a"
					serviceId="nabu.utils.Runtime.getDeviceFromToken"
					resultName="resultc8e82c670eaf49e8b17bb10be1ef5a3e"
					temporaryMapping="true"
					x="74"
					y="174"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="d3b7cd43-1ec5-4f6b-a9af-ae26b1254d30"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/token</from>
					<to>token</to>
				</steps>
			</steps>
		</steps>
	</steps>
</sequence>