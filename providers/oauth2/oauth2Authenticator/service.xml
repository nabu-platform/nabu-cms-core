<sequence xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		disabled="false"
		id="4283eca1-ba22-46a7-9ec8-34e1b4de885b">
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Enrich configuration"
			disabled="false"
			id="2000e691-ffbb-4a19-af8a-c854c4629049">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="7ef2a7e5-a65b-434a-bef0-221b3cd852b4"
				serviceId="nabu.cms.core.utils.initializeConfiguration"
				resultName="result38b14f9c16f84a99beb8470c554a2abe"
				temporaryMapping="true"
				x="89"
				y="54"
				invocationOrder="0"
				asynchronous="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="a99fce03-2501-49e8-94d5-d2187d8f4b63"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/configuration</from>
				<to>configuration</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="e0f1ca53-4d21-45c7-92d4-c201de3edd64"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result38b14f9c16f84a99beb8470c554a2abe/configuration</from>
			<to>input/configuration</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Get profile resolvers"
			disabled="false"
			id="742978b4-b0a7-404a-b70f-7018979147d2">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="721cf32a-3c4f-405a-9149-362802fc3741"
				serviceId="nabu.misc.configuration.Services.configurations"
				resultName="resultcadc1937c3134c5883d2536beff873e4"
				temporaryMapping="true"
				x="16"
				y="47"
				invocationOrder="0"
				asynchronous="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="2c542e96-3853-4ebe-9b6e-9ad7e5c09cb3"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>nabu.cms.core.providers.oauth2ProfileResolver</from>
				<to>typeId</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="3495f495-1f0b-4f93-81d6-0334d947c5b9"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>resultcadc1937c3134c5883d2536beff873e4/configurations</from>
			<to>profileResolvers</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Get specific resolver"
			disabled="false"
			id="8748c728-1dfd-424a-8058-f2c0e68d5f78">
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="9ab808bd-1e4f-40bf-b3fc-0aa339270f15"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>profileResolvers[oauth2Provider = /input/oauth2Provider]</from>
			<to>profileResolver</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
			disabled="false"
			id="b4830cc5-1776-4b23-8bda-79aeb405a7f4"
			query="profileResolver">
		<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
				disabled="false"
				id="ecad5c1c-d3f9-4e8f-b96a-bffd5433f40d"
				label="null"
				query="input/oauth2Provider">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					disabled="false"
					id="213a3ef4-fc53-4922-af43-696bdaabb6a4"
					label="&quot;nabu.cms.core.providers.oauth2.google.provider&quot;">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="76dad92f-d0fc-400b-be19-b85a7eea23f5"
						serviceId="nabu.cms.core.providers.oauth2.google.requestor"
						resultName="result9c70267918b441d0aac6370864189c23"
						temporaryMapping="true"
						x="74"
						y="174"
						invocationOrder="0"
						asynchronous="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="a29445c6-4d9c-412d-9127-3c7bb993349c"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/credentials/access_token</from>
						<to>authentication/username</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="f8d2b774-7531-4d66-9ec5-ea66617b3cc5"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result9c70267918b441d0aac6370864189c23/content/email</from>
					<to>email</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="1e2bf8b7-6b86-4efd-9190-cc640aa120a9"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result9c70267918b441d0aac6370864189c23/content/given_name</from>
					<to>firstName</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="25e1da77-662d-45c5-a147-dea821c9e6d9"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result9c70267918b441d0aac6370864189c23/content/family_name</from>
					<to>lastName</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="e9dc6962-1336-467f-bf2c-32c41eefe080"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result9c70267918b441d0aac6370864189c23/content/verified_email</from>
					<to>verified</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="7fb48afe-c16a-4b18-a2d6-b547948e0968"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result9c70267918b441d0aac6370864189c23/content/id</from>
					<to>externalId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="3c79a498-66c7-4671-a622-016fc5b11a0c"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>true</from>
					<to>success</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="81281e89-f0fb-42d7-beb5-664f4f49c1af"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result9c70267918b441d0aac6370864189c23/content</from>
					<to>properties</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					disabled="false"
					id="82899bba-5d2e-4e12-9052-c734b64edd09"
					label="&quot;nabu.cms.core.providers.oauth2.facebook.provider&quot;">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="f4ade8ab-ecbb-45b4-b4f8-eed13daca6f2"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>true</from>
					<to>verified</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="aa0e1d0f-0b0c-4022-9a4f-d067b78c24e8"
						serviceId="nabu.cms.core.providers.oauth2.facebook.requestor"
						resultName="result605c8c08bda74f2fbcf8b5ba5b984001"
						temporaryMapping="true"
						x="183"
						y="72"
						invocationOrder="0"
						asynchronous="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="7f27f597-1f7b-498d-84a8-1a0cd8854d43"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>email,first_name,last_name</from>
						<to>query/fields[0]</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="bf1739dd-c3e5-4beb-b546-bff69e8576e2"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/credentials/access_token</from>
						<to>query/access_token[0]</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="d487f9e3-049b-4c64-a567-f5c00bb63302"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result605c8c08bda74f2fbcf8b5ba5b984001/content/email</from>
					<to>email</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="4bb66092-b971-4de0-840d-99c1610e767b"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result605c8c08bda74f2fbcf8b5ba5b984001/content/first_name</from>
					<to>firstName</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="55ef415b-d88a-4f89-8e07-56a0b7f0b2dd"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result605c8c08bda74f2fbcf8b5ba5b984001/content/last_name</from>
					<to>lastName</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="cc40b461-e9b4-4af2-9c8a-37d6b24df40a"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result605c8c08bda74f2fbcf8b5ba5b984001/content/id</from>
					<to>externalId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="fc5d3af9-3557-4e4b-a1be-42314ade40f5"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>true</from>
					<to>success</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="00e69c5f-f5d0-467b-a6bb-bc9a0638fd59"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result605c8c08bda74f2fbcf8b5ba5b984001/content</from>
					<to>properties</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					disabled="false"
					id="0e8270ab-2ccc-43b5-8bad-d71088b49542"
					label="&quot;nabu.cms.core.providers.oauth2.linkedin.provider&quot;">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="2ecdf5f1-a946-43b8-91bb-0cc4246dafde"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>true</from>
					<to>verified</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="498157e1-c2c2-4adf-9a8d-c084b00e5116"
						serviceId="nabu.cms.core.providers.oauth2.linkedin.requestor"
						resultName="result71670a3380a149b6851cd217a5711490"
						temporaryMapping="true"
						x="105"
						y="239"
						invocationOrder="0"
						asynchronous="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="008b9bf2-f33f-4238-b849-7c7202b68161"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/credentials/access_token</from>
						<to>authentication/username</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="8c805706-1be2-4a2c-ac1f-94c431d43c19"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result71670a3380a149b6851cd217a5711490/content/id</from>
					<to>externalId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="eb9da9c7-9f20-485b-b74e-ea255424679e"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result71670a3380a149b6851cd217a5711490/content/emailAddress</from>
					<to>email</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="899d8df8-80d7-485e-8ca2-c89620e128b4"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result71670a3380a149b6851cd217a5711490/content/firstName</from>
					<to>firstName</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="03e74b12-0b01-4729-8e22-50603a3f405f"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result71670a3380a149b6851cd217a5711490/content/lastName</from>
					<to>lastName</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="d9df82ae-d3fc-4641-915b-06cb83d60fe2"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>true</from>
					<to>success</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="d534b9fe-89c0-4dc1-aacf-46ccb9a57785"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result71670a3380a149b6851cd217a5711490/content</from>
					<to>properties</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					disabled="false"
					id="69093454-f704-4669-998c-5a01584e0c17"
					label="&quot;nabu.cms.core.providers.oauth2.digipolis.antwerpen&quot;">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="24b62145-5cd4-41b9-8a06-bf9cb4994aec"
						serviceId="nabu.cms.core.providers.oauth2.digipolis.requestor"
						resultName="result2fed15eedf8f441b8bd1cc86d66cfa48"
						temporaryMapping="true"
						x="42"
						y="68"
						invocationOrder="0"
						asynchronous="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="82c9d5ed-0dd6-486c-8bce-6cb9a8a450e9"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/credentials/access_token</from>
						<to>authentication/username</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="91b26cf9-8f42-4d9e-b2d2-8c6356090363"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/apiEndpoint</from>
						<to>endpoint</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="c642e4bf-bbb1-4d49-8a79-bb53fa2e35bf"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result2fed15eedf8f441b8bd1cc86d66cfa48/content/data/id</from>
					<to>externalId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="8d1d1eb0-5ca7-4146-8068-10a7a12d5ca5"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result2fed15eedf8f441b8bd1cc86d66cfa48/content/data/emailPrimary</from>
					<to>email</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="fc3d289f-405c-4eff-9278-263ad50ef598"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result2fed15eedf8f441b8bd1cc86d66cfa48/content/data/firstName</from>
					<to>firstName</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="01b00e28-adf3-4e2f-a3d8-0158e9e32de5"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result2fed15eedf8f441b8bd1cc86d66cfa48/content/data/lastName</from>
					<to>lastName</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="de472c3f-2899-4e72-831b-563e273d98d3"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result2fed15eedf8f441b8bd1cc86d66cfa48/content/success</from>
					<to>success</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="3210b7dd-5819-45fe-8526-c75400748882"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>true</from>
					<to>verified</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="a541864e-ea55-4b39-b48f-a0b193169ec0"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result2fed15eedf8f441b8bd1cc86d66cfa48/content</from>
					<to>properties</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					disabled="false"
					id="e5e3d535-6f9a-42d1-ae87-4d888052fb1d"
					label="&quot;digipolis.authentication.mprofiel.stateful&quot;">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="b05372a7-84be-4220-b95d-119b372b68c1"
						serviceId="digipolis.engines.mprofiel.swagger.services.getMe"
						resultName="result496b059149dd49a89eb0c098e7576dad"
						temporaryMapping="true"
						x="46"
						y="58"
						invocationOrder="0"
						asynchronous="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="3d04b328-86fe-4c44-a120-dbc53abad4dd"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/credentials/access_token</from>
						<to>authentication/oauth2Token</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="764d93d2-5325-4207-a787-a8ff82774dea"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result496b059149dd49a89eb0c098e7576dad/ok/body</from>
					<to>properties</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="8cf142bb-f4eb-44ea-8816-b22235d9d7d0"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result496b059149dd49a89eb0c098e7576dad/ok/body/workEmail</from>
					<to>email</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="b1dbe030-d2ab-4b47-8a9c-5e4bfa23a27e"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result496b059149dd49a89eb0c098e7576dad/ok/body/firstName</from>
					<to>firstName</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="d6090e1f-c1ec-49ef-a4d4-4ad2b469b200"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result496b059149dd49a89eb0c098e7576dad/ok/body/lastName</from>
					<to>lastName</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="972a35f9-609a-4356-ad4a-4531e6c7dc2c"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>true</from>
					<to>verified</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="5c6c91b2-2b55-4400-a2ff-f9675102b45f"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>true</from>
					<to>success</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="b46774d9-fb26-4bbe-be03-501d87a3e971"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result496b059149dd49a89eb0c098e7576dad/ok/body/id</from>
					<to>externalId</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					disabled="false"
					id="754217a3-4c18-4700-b493-37fef2b007ad"
					label="&quot;nabu.cms.core.providers.oauth2.fodged.stateful&quot;">
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Throw"
					disabled="false"
					id="a9898abc-3a92-4d36-bda6-df0886951e29"
					message="=&quot;Unknown provider: &quot; + input/oauth2Provider" xsi:nil="true"/>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				disabled="false"
				id="c62462b5-a6ed-409a-998a-543606e47681">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="5aacadf1-3d95-445a-bcc0-b80c76f90056"
					serviceId="nabu.cms.core.interfaces.oauth2ProfileResolver"
					resultName="result83c57c8f00aa4800a9069e5ca87a4c36"
					temporaryMapping="true"
					x="36"
					y="82"
					invocationOrder="0"
					asynchronous="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="93237c08-1cb7-4691-a27e-0c477bcd46d1"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/apiEndpoint</from>
					<to>apiEndpoint</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="0d0fe0a9-b5e7-41cc-9ebe-df9aa8f8b6e7"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/credentials</from>
					<to>credentials</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="c5a4b6f5-a9fd-4974-9d5b-7fef70749343"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>profileResolver/oauth2ProfileResolver</from>
					<to>implementationId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="0b83d8af-7e01-4ec3-bd4e-2dd46729fb6c"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>true</from>
					<to>useAsContext</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="d441a9e2-73b0-434a-bd6a-a1110dcbb571"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result83c57c8f00aa4800a9069e5ca87a4c36/email</from>
				<to>email</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="626d4c2e-6db0-408e-8e7f-4fc322e5676b"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result83c57c8f00aa4800a9069e5ca87a4c36/firstName</from>
				<to>firstName</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="9ac970b9-7fca-4960-8d87-966aa46bea70"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result83c57c8f00aa4800a9069e5ca87a4c36/lastName</from>
				<to>lastName</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="b70db761-c3a1-4553-9b39-e2a4d5a3db83"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result83c57c8f00aa4800a9069e5ca87a4c36/verified</from>
				<to>verified</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="560c6f85-f943-4893-a54d-773a836847a7"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result83c57c8f00aa4800a9069e5ca87a4c36/properties</from>
				<to>properties</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="22dcba0a-c5e4-425e-8e35-db1c8e53bf26"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result83c57c8f00aa4800a9069e5ca87a4c36/accountId</from>
				<to>externalId</to>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
			disabled="false"
			id="799f7006-2b10-4a0a-a231-a412c266ca6d"
			query="success">
		<steps xsi:type="be.nabu.libs.services.vm.step.Throw"
				disabled="false"
				id="146f6c11-1538-4997-b750-9629dd938b27"
				label="false"
				message="Could not successfully resolve user" xsi:nil="true"/>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
			disabled="false"
			id="fdc15d91-b4e1-4beb-a8f9-af356c410d29">
		<steps xsi:type="be.nabu.libs.services.vm.step.Throw"
				disabled="false"
				id="bd41b8df-fa95-4c9c-9302-c8ecf9486f7f"
				label="email = null"
				message="Could not resolve a valid email address for oauth2 token" xsi:nil="true"/>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Select user by mail"
			disabled="false"
			id="7e88f8ba-82cb-40a1-b749-b1a46417f098">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="bf62b60a-f620-44c7-b7bd-e3bbebfd43a3"
				serviceId="nabu.cms.core.database.user.selectActiveByAlias"
				resultName="result920090ae10194612a64dfac46250b00c"
				temporaryMapping="true"
				x="68"
				y="14"
				invocationOrder="0"
				asynchronous="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="4639a8c5-22b0-4f0b-93fc-18e485d4b1f8"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/configuration/connectionId</from>
				<to>connection</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="93daad8f-a4ce-42ad-833f-cb136c97377e"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/realm</from>
				<to>parameters/realm</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="ca85f33c-e8b2-48e7-96f5-1e9405345695"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>email</from>
				<to>parameters/alias</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="462908d7-330e-439a-bfd7-6088d359ed52"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/configuration/caseInsensitive</from>
				<to>parameters/caseInsensitive</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="01d2f6b0-e349-4346-bfe5-92364b17045b"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result920090ae10194612a64dfac46250b00c/results[0]</from>
			<to>user</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="6af03460-fc57-422e-9c5f-c8f81d1d8f07"
				mask="false"
				optional="false"
				fixedValue="true">
			<from>false</from>
			<to>isNewUser</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="89c5ee13-1cd7-465c-a824-be491c3e2317"
				mask="false"
				optional="false"
				fixedValue="true">
			<from>false</from>
			<to>newUser</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
			comment="If we have an external id and no user, check if we have logged in before but with a different alias"
			disabled="false"
			id="ba43dc42-9c78-484f-a939-0d1f9c81479c"
			label="!user &amp;&amp; externalId != null &amp;&amp; input/configuration/allowExternalEmailChange = true">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Get existing credential for this external id"
				disabled="false"
				id="d10b7838-8002-4d74-bb12-025b8eb74f3d">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="1fefc62e-1afd-42a4-b43e-389cd9ea3730"
					serviceId="nabu.cms.core.database.user.oauth2Credential.selectByAccountId"
					resultName="result9c899ce9e33140f4ab0b2724693a7f8f"
					temporaryMapping="true"
					x="52"
					y="90"
					invocationOrder="0"
					asynchronous="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="4afc3ccd-ade4-4cf5-9b31-6b107659f23d"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>externalId</from>
					<to>parameters/accountId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="a569cdfc-d135-4f2c-80bb-deb2d2a4b481"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/webApplication</from>
					<to>parameters/webApplication</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="9272ac3a-bf45-4366-ac9a-01602535e51f"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/oauth2Provider</from>
					<to>parameters/provider</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="4e5d29f5-882e-4609-839d-fa50ada73ad2"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>1</from>
					<to>limit</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="f15396ea-487e-4172-8a84-601cc5a332b4"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/configuration/connectionId</from>
					<to>connection</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="e4e9f4b3-f8f1-4214-9d2b-3193c1e1ec3b"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result9c899ce9e33140f4ab0b2724693a7f8f/results[0]</from>
				<to>existingCredential</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
				disabled="false"
				id="8cf6fd24-7fad-439f-a503-e36c60eb01e3"
				label="existingCredential">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					disabled="false"
					id="d430d3d4-cdc5-4606-a311-0ccd15a93075">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="59d57c11-00a4-4f5f-91c8-7600a33d2e34"
						serviceId="nabu.cms.core.services.node.audit.create"
						resultName="result5b0c1ff1865e4c5fa1cfb2c32c94a47c"
						temporaryMapping="true"
						x="84"
						y="57"
						invocationOrder="0"
						asynchronous="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="4349cbde-e4c1-4ccc-b48d-6b929bf44e7c"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>user.email.change</from>
						<to>action</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="685031e8-8e04-405e-a1db-110a9a016e43"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>oauth2</from>
						<to>description</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="2bacf80a-04de-4a77-aa1f-e193b182bfe5"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/configuration/connectionId</from>
						<to>connectionId</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="b812b0e1-2c53-4840-89ee-69043d447c53"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/device</from>
						<to>device</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="7bc2eeaa-0854-4afc-9585-079fe9920b5f"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>existingCredential/userId</from>
						<to>nodeId</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="33fb9ef0-c693-4f90-be32-1c1cfa2100e1"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result5b0c1ff1865e4c5fa1cfb2c32c94a47c/auditId</from>
					<to>auditId</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
					disabled="false"
					id="79741171-6251-47c2-8972-cda7cd1e04fb">
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Select by id"
						disabled="false"
						id="89b7e63f-e137-4536-aeff-92c0cef245d9">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="09f9132c-5461-478d-a19a-94f6724dac4b"
							serviceId="nabu.cms.core.database.user.selectById"
							resultName="result460a02b25aa742efae4a73fc1ae2cfea"
							temporaryMapping="true"
							x="125"
							y="67"
							invocationOrder="0"
							asynchronous="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="963d63cc-3858-4f34-a3cf-d278358ccf63"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>existingCredential/userId</from>
							<to>parameters/id</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="e25eabab-db73-441f-951c-5b409c653eaf"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>input/configuration/connectionId</from>
							<to>connection</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="a390c991-33aa-48aa-a328-a2d76b6aa063"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result460a02b25aa742efae4a73fc1ae2cfea/results[0]</from>
						<to>user</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Update email"
						disabled="false"
						id="60c24b20-2f3b-471b-b78e-a5ce3322a73f">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="7304d77c-02de-43a7-9d0b-b92060549eb3"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>email</from>
						<to>user/alias</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="7f6379c8-d50a-40f9-b908-fa08592c2fc7"
							serviceId="nabu.utils.Date.now"
							resultName="result477121849a2441509652b734e71ad5ce"
							temporaryMapping="true"
							x="283"
							y="67"
							invocationOrder="0"
							asynchronous="false">
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="3a8eb1b4-168e-41d9-805c-6ff5f82c28d3"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result477121849a2441509652b734e71ad5ce/date</from>
						<to>user/modified</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Persist"
						disabled="false"
						id="c474828a-cedf-40a8-ad8e-ddf170abd790">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="792068c2-0cec-415c-9ecb-54f0a5d374c1"
							serviceId="nabu.services.jdbc.Services.update"
							resultName="resultae52c1f849774a3cb786f7e453453762"
							temporaryMapping="true"
							x="62"
							y="141"
							invocationOrder="0"
							asynchronous="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="1dd1fe2f-bac5-44e8-82a1-05f7d00788ac"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>user</from>
							<to>instances[0]</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="503fea49-841e-4645-88b4-ca2da25e6aaa"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>nabu.cms.core.providers.misc.changeTracker</from>
							<to>changeTracker</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="eeee1705-63c8-46f6-83d2-b5af471be7c2"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>input/configuration/connectionId</from>
							<to>connection</to>
						</steps>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Update audit"
						disabled="false"
						id="67ca298c-0a84-410b-8b91-ab236a9aae6e">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="133f8686-4114-48e7-8426-3790bc6b51d0"
							serviceId="nabu.cms.core.database.node.audit.updateActor"
							resultName="result3a504993b0574b93bbfb314a82add3e5"
							temporaryMapping="true"
							x="53"
							y="285"
							invocationOrder="0"
							asynchronous="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="85c8cf0b-7fd4-48bd-9b73-832e99798834"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>auditId</from>
							<to>parameters[0]/id</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="fdeaa439-ebc6-44f0-bdbe-cb76cf474805"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>user/id</from>
							<to>parameters[0]/actorId</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="d97f561b-f4b1-4941-9f45-2492a5326acf"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>input/configuration/connectionId</from>
							<to>connection</to>
						</steps>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Catch"
						disabled="false"
						id="e78ea9e52b5f4cf096cebb1b442c2d8c"
						variable="exception">
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							disabled="false"
							id="7c8707f39bbf4ed5b663b2b301d9ef3a">
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="8c568b027fe84703bb0612ce5d59804b"
								serviceId="nabu.cms.core.services.node.audit.error"
								resultName="resultf0058a1ba5fc4283b405f086eccb1e80"
								temporaryMapping="true"
								x="33"
								y="78"
								invocationOrder="0"
								asynchronous="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="b382b67a61e544329b97b84a5287070a"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>exception</from>
								<to>exception</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="99943d3dca9b428f9ba784a984511e41"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>input/configuration/connectionId</from>
								<to>connectionId</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="100ef8b4-68da-4631-b25a-bd8dc38b3ebe"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>auditId</from>
								<to>auditId</to>
							</steps>
						</steps>
					</steps>
				</steps>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Throw"
			disabled="false"
			id="5f730bfb-28a9-4df9-90b4-77caa879c214"
			label="input/configuration/inviteOnly != null &amp;&amp; input/configuration/inviteOnly &amp;&amp; user == null"
			message="The site is configured as invite only" xsi:nil="true"/>
	<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
			comment="Check that the user is not anonymous"
			disabled="false"
			id="6da48c8e-b84c-4d3a-a016-640f7958175d">
		<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
				disabled="false"
				id="4ac1cc50-d1b4-4731-8f2a-ad3943c1143b"
				label="user/anonymous != null &amp;&amp; user/anonymous">
			<steps xsi:type="be.nabu.libs.services.vm.step.Throw"
					disabled="false"
					id="102e52eb-7408-4971-83a3-852f3fe2c390"
					label="input/configuration/allowAnonymousLogin == null || !input/configuration/allowAnonymousLogin"
					code="ANONYMOUS-LOGIN"
					message="Can not log in with an anonymous account"
					description="=&quot;Can not log in with an anonymous account: &quot; + email"
					alias="=user/alias"
					realm="=user/realm" xsi:nil="true"/>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="2c01621565074c71be9ba8cd2631628d">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="f8cdf4046e3e4e41a13083b6550a4dca"
				serviceId="nabu.cms.core.services.node.audit.create"
				resultName="result5b0c1ff1865e4c5fa1cfb2c32c94a47c"
				temporaryMapping="true"
				x="84"
				y="57"
				invocationOrder="0"
				asynchronous="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="5c9415ee93dc4b10acbc51a155ce1f51"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>user.authenticate</from>
				<to>action</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="1d6b58c333ad46e7a802c4ab62020b7d"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>oauth2</from>
				<to>description</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="b11cfcb99f4d4f6eb4bae9d88252bcbb"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/configuration/connectionId</from>
				<to>connectionId</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="651fc66f57fb45ecbaa0c08eb4eaa314"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>user/id</from>
				<to>nodeId</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="48c9477da8fe464ea68bddeef485529b"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/device</from>
				<to>device</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="3fa6ae51bc964bd8a1a7d4ef94b9defb"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result5b0c1ff1865e4c5fa1cfb2c32c94a47c/auditId</from>
			<to>auditId</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
			disabled="false"
			id="283873d7-e748-4515-9634-4af5b77e5a3a">
		<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
				disabled="false"
				id="9d059221-6d9b-4e5b-a5a5-3f637df6e860"
				query="user">
			<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
					comment="Manage own sequence for transactions (instead of using the action service)"
					disabled="false"
					id="2eacd71e-1db5-4a6b-baa1-f38023ef97ac"
					label="null">
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						disabled="false"
						id="3302098fd14f4e23a9e00f7469077d03">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="0d8d646e00be418499a90b5a39e912d5"
							serviceId="nabu.cms.core.services.node.audit.create"
							resultName="result5b0c1ff1865e4c5fa1cfb2c32c94a47c"
							temporaryMapping="true"
							x="189"
							y="34"
							invocationOrder="0"
							asynchronous="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="77acd8ae10204b649e44092ffe1c7269"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>user.create</from>
							<to>action</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="dd571e3721d2401293e5dbdef9fc44ba"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>oauth2</from>
							<to>description</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="b34cdc57e3a3461f9e7bd80299431604"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>input/configuration/connectionId</from>
							<to>connectionId</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="9acface242504da184ca9d410c2f400a"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>input/device</from>
							<to>device</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="20b5b7c3-0645-4be3-9ea6-cc546a2b7e3c"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>auditId</from>
							<to>parentAuditId</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="68dbbf08-ce73-4249-9afb-b518bf9a9e5c"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result5b0c1ff1865e4c5fa1cfb2c32c94a47c/auditId</from>
						<to>userCreateAuditId</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
						disabled="false"
						id="0dbac8f5-e68e-4ac2-a4b9-bd91b522e9de">
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							comment="Create user"
							disabled="false"
							id="e4900d6b-74d3-4a4c-86dd-0f257c6bbbf4">
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="558f8a13-2e63-4319-a4ae-656792034d00"
								serviceId="nabu.cms.core.services.user.create"
								resultName="resulta1587f30fb1d4d7b872b39b401e254b6"
								temporaryMapping="true"
								x="394"
								y="151"
								invocationOrder="0"
								asynchronous="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="ae5dbbb4-3634-4431-a96f-791dfbcff35a"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>input/configuration/connectionId</from>
								<to>connectionId</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="1bbbb9f8-623c-4964-bd54-a85fce97a5cd"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>email</from>
								<to>alias</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="f10b71aa-3745-463d-ba57-7428b5d161bf"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>verified</from>
								<to>verified</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="3369db4e-7902-4943-93ee-758c2b77ecd9"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>input/realm</from>
								<to>realm</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="799ba001-61af-464d-9fd6-97775fd27cb7"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>auditId</from>
								<to>transactionId</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="ee411af4-43c4-428e-82e7-524f835f2c2a"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>input/webApplication</from>
								<to>webApplicationId</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="dbfe09fc-09ce-468b-a326-25be773dcdac"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>resulta1587f30fb1d4d7b872b39b401e254b6/user</from>
							<to>user</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="71bdd862-e274-4cdc-a89f-c8142d0a82d7"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>true</from>
							<to>isNewUser</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="c505f28b-ba62-42e2-9b2b-012e8ba261bf"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>true</from>
							<to>newUser</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Catch"
							disabled="false"
							id="5a378ab8-0cef-4cfb-b97b-e0197fc449aa"
							variable="exception">
						<steps xsi:type="be.nabu.libs.services.vm.step.Map"
								disabled="false"
								id="e69b3dc1-ce31-4ccd-a217-29b0bee13169">
							<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
									disabled="false"
									id="7544cff1-b2ee-4d72-b277-3b9535f04140"
									serviceId="nabu.cms.core.services.node.audit.error"
									resultName="resultf0058a1ba5fc4283b405f086eccb1e80"
									temporaryMapping="true"
									x="154"
									y="85"
									invocationOrder="0"
									asynchronous="false">
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="011869f5-da36-464c-8171-6ba66434cb62"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>exception</from>
									<to>exception</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="cdae914c-f6a7-4b52-93f2-4515e9969a34"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>input/configuration/connectionId</from>
									<to>connectionId</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="6ce74eb9-14dc-4393-b3c7-dc6d245d68a8"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>userCreateAuditId</from>
									<to>auditId</to>
								</steps>
							</steps>
						</steps>
					</steps>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
					comment="Check if it is an alias for another user"
					disabled="false"
					id="1459fa62-ca2a-4cfd-ab27-bc6051f3bb30">
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Get the node for the user"
						disabled="false"
						id="e66188b1-e332-40a1-ba16-0065c12c9745">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="eb529d8c-1ffe-4557-8cfc-5fc1b2243045"
							serviceId="nabu.cms.core.database.node.selectById"
							resultName="result05f11f577860424da84b25f4e104eb0b"
							temporaryMapping="true"
							x="224"
							y="92"
							invocationOrder="0"
							asynchronous="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="32ad0223-33d5-4d26-9814-65855b5209f3"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>user/id</from>
							<to>parameters/id</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="467dc839-5683-41ed-9824-1a21f764d243"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>input/configuration/connectionId</from>
							<to>connection</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="6f4dbdfa-954c-4400-8b29-504c60781927"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result05f11f577860424da84b25f4e104eb0b/results[0]</from>
						<to>userNode</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="If the user is not his own owner, it is an alias account"
						disabled="false"
						id="42260c21-6970-4334-a179-4244e4d42fb7"
						label="userNode/ownerId != null &amp;&amp; userNode/ownerId != userNode/id">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="77ff9e55-c383-485d-a8e4-c3da21829aa0"
							serviceId="nabu.cms.core.database.user.selectById"
							resultName="resultd3dd9ec0cba54e51b78e016b3ec12c12"
							temporaryMapping="true"
							x="102"
							y="56"
							invocationOrder="0"
							asynchronous="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="d2927fa9-8142-4533-933e-38313bf0712a"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>input/configuration/connectionId</from>
							<to>connection</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="241d4d6c-20da-4491-b2bc-70332abfbc87"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>userNode/ownerId</from>
							<to>parameters/id</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="0b9f5321-c19e-496d-a59c-4a1282d5afa6"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>resultd3dd9ec0cba54e51b78e016b3ec12c12/results[0]</from>
						<to>user</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Throw"
						disabled="false"
						id="f143539b-0434-44bd-9727-5ebcc83ebdac"
						label="!user"
						message="Invalid owner"
						description="=&quot;Invalid owner for &quot; +  email + &quot; in &quot; + input/realm"
						alias="=user/alias"
						realm="=user/realm" xsi:nil="true"/>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
				disabled="false"
				id="204d38e1-86fb-409e-bacf-d3845d760363">
			<steps xsi:type="be.nabu.libs.services.vm.step.Throw"
					disabled="false"
					id="e7aec416-c262-4196-a070-c60e7a998ee7"
					label="user == null"
					message="Could not find or create user" xsi:nil="true"/>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					disabled="false"
					id="e56a06e3-930a-46bc-89d9-cc970068f8df"
					label="newUser">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="db9745d3-1e5c-4b02-b654-bd23a5e963a7"
						serviceId="nabu.cms.core.database.node.audit.update"
						resultName="result3649f313ad354bcaa6324ceb9cdd7b37"
						temporaryMapping="true"
						x="213"
						y="103"
						invocationOrder="0"
						asynchronous="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="eeb2c18e-0afa-4b08-baf2-0fdd408cb214"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/configuration/connectionId</from>
						<to>connection</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="9b27cd4e-a6e4-4b8e-af89-497f36644894"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>auditId</from>
						<to>parameters[0]/id</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="1d676f5b-7a96-4b8c-9b79-3d90182f787a"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>user/id</from>
						<to>parameters[0]/nodeId</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="fabbc605-245c-4841-b46b-23e0a1c7eafd"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>auditId</from>
						<to>transaction</to>
					</steps>
				</steps>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Get oauth2 entry for this provider"
				disabled="false"
				id="9bca3165-dfab-4fec-8632-14f0d420904e">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="766e41ad-6d9c-48aa-9789-70d018b37261"
					serviceId="nabu.cms.core.database.user.oauth2Credential.selectByProvider"
					resultName="resultbe413ecea43341d2ac5932785bf03460"
					temporaryMapping="true"
					x="23"
					y="65"
					invocationOrder="0"
					asynchronous="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="aa096934-69d8-4e24-820c-2f95cdd39da3"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/configuration/connectionId</from>
					<to>connection</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="950744c6-b063-4273-97b2-85827c058cc9"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>user/id</from>
					<to>parameters/userId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="6b6d9b2f-7b2f-476d-bca3-b23cb8265a65"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/oauth2Provider</from>
					<to>parameters/provider</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="bf1bb4ab-4ef2-47b1-ae9f-05c6ecd3ca33"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/webApplication</from>
					<to>parameters/webApplication</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="a75a2942-2ee6-4a45-961a-7ef006647e43"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>resultbe413ecea43341d2ac5932785bf03460/results[0]</from>
				<to>oauth2Credential</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
				disabled="false"
				id="820b8c95-057f-4100-ba8e-0d12e07dfbbe"
				query="oauth2Credential">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					disabled="false"
					id="a0e817ca-7ba5-4212-9d02-24e5760414bf"
					label="null">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="adfdc0a4-6f19-4a9a-ad9c-a89ab6170b1c"
						serviceId="nabu.cms.core.database.user.oauth2Credential.insert"
						resultName="result303b90a5b3dc4547b151654ff10ff595"
						temporaryMapping="true"
						x="399"
						y="118"
						invocationOrder="2"
						asynchronous="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="2b874a2b-aef3-46bd-8045-3fe06033a596"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/configuration/connectionId</from>
						<to>connection</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="b94aa8d5-565f-44ba-9f33-aca74cd03471"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>resulte0fcad9b76854d4fa0a39986cd1fa9a5/uuid</from>
						<to>parameters[0]/id</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="55255e47-2f2d-49bc-aa52-d9dee4b22008"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>resultaa5dec22b07b4e32a02091d3dc4a851e/date</from>
						<to>parameters[0]/created</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="b589a7e8-7877-4fd8-bb91-ff16b9045e7b"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>resultaa5dec22b07b4e32a02091d3dc4a851e/date</from>
						<to>parameters[0]/modified</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="5adcec35-7be6-4f2d-a901-d18af2d1832f"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/oauth2Provider</from>
						<to>parameters[0]/oauth2Provider</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="33e06d8a-3a57-4eb8-a807-cf72adeab282"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/credentials/access_token</from>
						<to>parameters[0]/token</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="611347c0-eef1-4ead-aa03-7aded4bf3c8e"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/credentials/refresh_token</from>
						<to>parameters[0]/refreshToken</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="1cf1d7a9-a554-4f6e-a559-d7397897cf2f"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>user/id</from>
						<to>parameters[0]/userId</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="23169e06-7d39-425c-8b4e-fa54ac74a0e2"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result101f61c12302411d8c02bffbba8068c3/date</from>
						<to>parameters[0]/activeUntil</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="a7d09ed1-4b4d-4618-86be-2d27f3ad3ae4"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/credentials/token_type</from>
						<to>parameters[0]/tokenType</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="956e81bb-adb1-41b2-a1b0-8e83b393cf15"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>externalId</from>
						<to>parameters[0]/accountId</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="49512d76-2c1a-42c2-a8ba-29c9b6ccf099"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>auditId</from>
						<to>transaction</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="3c4606fd-ec3f-4213-8d97-6dd567b9a852"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/webApplication</from>
						<to>parameters[0]/webApplication</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="eb4c7037-be81-4b85-be1b-12c68abefb15"
						serviceId="nabu.utils.Server.uuid"
						resultName="resulte0fcad9b76854d4fa0a39986cd1fa9a5"
						temporaryMapping="true"
						x="62"
						y="40"
						invocationOrder="0"
						asynchronous="false">
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="f8d662fc-493d-4e95-83b8-0c76852603b8"
						serviceId="nabu.utils.Date.now"
						resultName="resultaa5dec22b07b4e32a02091d3dc4a851e"
						temporaryMapping="true"
						x="36"
						y="128"
						invocationOrder="0"
						asynchronous="false">
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="53a48dc5-12a9-40d1-bd32-ec74fd29f2f0"
						serviceId="nabu.utils.Date.increment"
						resultName="result101f61c12302411d8c02bffbba8068c3"
						temporaryMapping="true"
						x="24"
						y="359"
						invocationOrder="1"
						asynchronous="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="d2f67247-283b-4b03-bec5-e8f199c925fe"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/credentials/expires_in</from>
						<to>increment</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="1fca4825-7383-4169-a6de-f9e0d7874b36"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>SECONDS</from>
						<to>unit</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="414e1b4f-1bb1-4807-827b-dcc80f2d4a32"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>resultaa5dec22b07b4e32a02091d3dc4a851e/date</from>
						<to>start</to>
					</steps>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					disabled="false"
					id="d443250b-7c38-4ce2-a78f-e4f2b10927d8">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="02a04d8c-8625-41e9-82fe-a6fe6d06e2dc"
						serviceId="nabu.cms.core.database.user.oauth2Credential.update"
						resultName="result90e306c7c0284da0ae092797ff5df245"
						temporaryMapping="true"
						x="473"
						y="199"
						invocationOrder="2"
						asynchronous="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="783ef970-16bf-4863-87b5-aa2b7c9c3537"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/configuration/connectionId</from>
						<to>connection</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="a5f7992b-1489-4a90-a13e-ea6b79ad3722"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>oauth2Credential/id</from>
						<to>parameters[0]/id</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="6d79947e-f1cb-49da-beae-d398672d95fb"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result4b6f0cb614c74452b24661fc9bb22521/date</from>
						<to>parameters[0]/activeUntil</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="37b0c3b5-2af3-4297-8460-48731107d551"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result3b884e1b7d774ee5b21250df1c73fe38/date</from>
						<to>parameters[0]/modified</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="d67404d2-8f6a-47a3-9a4c-544dba4dd335"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/credentials/token_type</from>
						<to>parameters[0]/tokenType</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="0fb94765-e620-451e-b580-f0f9671b1301"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>externalId</from>
						<to>parameters[0]/accountId</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="1b307194-4cba-4ad2-b4dd-7b78a21e19ce"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/credentials/refresh_token</from>
						<to>parameters[0]/refreshToken</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="fd35bb9c-3163-4ee1-aa7e-afc07692ccd8"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/oauth2Provider</from>
						<to>parameters[0]/oauth2Provider</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="753df713-eafb-49a3-93fb-4ddad5f24df2"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/credentials/access_token</from>
						<to>parameters[0]/token</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="3b3f268c-c01f-4640-bc84-13dc8c5f7d60"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>auditId</from>
						<to>transaction</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="9a72cc53-80e3-4255-86b7-6d1345c6f28f"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/webApplication</from>
						<to>parameters[0]/webApplication</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="3626a9fd-854c-4026-9690-1cfdd24963fb"
						serviceId="nabu.utils.Date.now"
						resultName="result3b884e1b7d774ee5b21250df1c73fe38"
						temporaryMapping="true"
						x="49"
						y="72"
						invocationOrder="0"
						asynchronous="false">
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="25e50cfe-2277-4911-b6e5-b05ccaab7aba"
						serviceId="nabu.utils.Date.increment"
						resultName="result4b6f0cb614c74452b24661fc9bb22521"
						temporaryMapping="true"
						x="101"
						y="508"
						invocationOrder="1"
						asynchronous="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="e4e4e4d8-18fa-4ee2-bfa1-cb687f4d3c96"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/credentials/expires_in</from>
						<to>increment</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="048f76de-8dd0-4864-84a2-80f786206bdf"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>SECONDS</from>
						<to>unit</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="163f49af-36ea-4d0d-8b3b-6dc485d95678"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result3b884e1b7d774ee5b21250df1c73fe38/date</from>
						<to>start</to>
					</steps>
				</steps>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Get user devices"
				disabled="false"
				id="8d9f3a30-36ad-4601-a49c-8c09a3eec770">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="3b707215-2a67-45b7-bf47-7e2fd7504b66"
					serviceId="nabu.cms.core.services.user.device.getForUser"
					resultName="result590e55c257a24da4a1b279a26822c271"
					temporaryMapping="true"
					x="62"
					y="53"
					invocationOrder="0"
					asynchronous="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="8523098a-8488-4d2f-8dff-1de4af7a80cc"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/configuration/connectionId</from>
					<to>connectionId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="ff6d5c38-11fc-40c1-bc1c-d93aa780c9a6"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>user/id</from>
					<to>userId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="a9e62e61-f88c-4c39-87b2-cc48f2dc25a9"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/device</from>
					<to>device</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="d5f13717-3826-444b-b522-b21a111dd0e7"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/configuration/maxAmountOfDevices</from>
					<to>maxAmountOfDevices</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="f91e8f23-a587-4c7d-a7af-f8f787a7a8c1"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/configuration/implementations/sendDeviceVerification</from>
					<to>sendDeviceVerificationService</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="76ad6821-de7c-45cb-b449-6cb0a7d0d68c"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>=input/configuration/allowNewDevices || isNewUser</from>
					<to>allowNewDevices</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="fe12545f-ff3d-4283-805a-6bf426eec7ca"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>auditId</from>
					<to>auditId</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="44d8f9e9-c8ea-4e2a-b535-75c789ca6212"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result590e55c257a24da4a1b279a26822c271/device</from>
				<to>currentDevice</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
				disabled="false"
				id="ac17d500-deed-460d-8146-253b3daa4c59"
				query="currentDevice/allowed">
			<steps xsi:type="be.nabu.libs.services.vm.step.Throw"
					disabled="false"
					id="7c6d17f3-b369-482f-bc3b-8e97367289ce"
					label="false"
					code="AUTHENTICATE-2"
					message="Device not allowed"
					alias="=user/alias"
					realm="=user/realm" xsi:nil="true"/>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					disabled="false"
					id="7b11f7f319594f6e8d56aed9547ed20a">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="f1050d2a9bef4498bf0802b065b71937"
						serviceId="nabu.cms.core.database.node.audit.update"
						resultName="resultc26fd9eed12443539864a6c9bffe1ddc"
						temporaryMapping="true"
						x="77"
						y="58"
						invocationOrder="0"
						asynchronous="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="ba1b373664444b42a201bcf15faefda7"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/configuration/connectionId</from>
						<to>connection</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="aae6047d86564a7594bedaa2e7eccd20"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>auditId</from>
						<to>parameters[0]/id</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="7249766e326d4515a75858ef33f538aa"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>currentDevice/id</from>
						<to>parameters[0]/deviceId</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="b3ac3bcdc9214a7ebc4c4dda649fb032"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>auditId</from>
						<to>transaction</to>
					</steps>
				</steps>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
				disabled="false"
				id="0a9c077b-0bb1-4e3f-ae26-0a48b9e242d4">
			<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
					disabled="false"
					id="93132b1a-8bdd-4bf8-8c54-1d33483f7dca"
					label="newUser &amp;&amp; input/configuration/implementations/oauth2ProfileCreator != null">
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Set the correct service context"
						disabled="false"
						id="2e00b8bc-e128-4c52-94a2-6818fbc4db3b">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="fad40703-61ea-4c93-b2ee-96e4b12f17de"
							serviceId="nabu.utils.Runtime.setServiceContext"
							resultName="resulta413c9b0eaeb4ee98798505162c6cb29"
							temporaryMapping="true"
							x="30"
							y="95"
							invocationOrder="0"
							asynchronous="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="d08ffeda-9557-4062-aa07-c739da87edf0"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>input/configuration/implementations/oauth2ProfileCreator</from>
							<to>context</to>
						</steps>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						disabled="false"
						id="44e8e09d-d53c-461a-a499-4b50b6320cf6">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="45cb7d9f-e4f2-4511-8124-d59b550156bf"
							serviceId="nabu.cms.core.interfaces.oauth2ProfileCreator"
							resultName="result6901ec1522ec42e5a9b6ecae6b31d320"
							temporaryMapping="true"
							x="70"
							y="98"
							invocationOrder="0"
							asynchronous="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="fec54891-d32f-4956-b2fe-421b5a61964a"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>input/oauth2Provider</from>
							<to>oauth2Provider</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="eef7dc51-4a57-4883-87d5-ab4550694e44"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>user</from>
							<to>user</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="06b92283-c1e3-4a16-b714-0740954adffc"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>currentDevice</from>
							<to>device</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="de77eac9-5a99-40a5-92d3-d8858fd4cd3f"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>auditId</from>
							<to>auditId</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="177d9eda-f0eb-45cb-bcc3-5e4568a27a10"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>input/configuration/implementations/oauth2ProfileCreator</from>
							<to>implementationId</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="739bdc6c-ddbe-43bb-a1ae-742aeb3e44c6"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>properties</from>
							<to>properties</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="50b78815-e81a-42a5-967d-421fd27ea8da"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>input/configuration</from>
							<to>configuration</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="968381d4-4ea3-4c34-9d2e-f5d8053ce59e"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>auditId</from>
							<to>transactionId</to>
						</steps>
					</steps>
				</steps>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
				disabled="false"
				id="5dc5b809-3448-4a89-b452-2c0a4b47d9d2"
				label="input/configuration/allowRemember">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Create a new secret"
					disabled="false"
					id="6269502b-4424-4381-a81a-a839b10bcea6"
					label="true">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="1715ceea-8a8a-4bba-9017-e7fdbac2509e"
						serviceId="nabu.utils.Server.uuid"
						resultName="result26d815b27f2841abb5ffb04fa433090b"
						temporaryMapping="true"
						x="23"
						y="19"
						invocationOrder="0"
						asynchronous="false">
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="427c5811-9341-436f-b407-3f7152ad9ec2"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result26d815b27f2841abb5ffb04fa433090b/uuid</from>
					<to>output/response/secret</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="51c836b7-ee80-4856-bb80-70fc7013dbd3"
						serviceId="nabu.utils.Date.now"
						resultName="result9eccbba9a94a4604a93003e7ed7f0591"
						temporaryMapping="true"
						x="51"
						y="371"
						invocationOrder="0"
						asynchronous="false">
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="bcb36d52-b876-4705-ba59-231617fb6bdd"
						serviceId="nabu.cms.core.database.user.device.update"
						resultName="result7206ef39f233433fa8e594dea2ce81fa"
						temporaryMapping="true"
						x="467"
						y="374"
						invocationOrder="2"
						asynchronous="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="cdfb10ee-90e8-4637-9525-b3fa95f3ebb7"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/configuration/connectionId</from>
						<to>connection</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="ad208c7b-50fe-4217-9a4e-985fd677c4c8"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>currentDevice/id</from>
						<to>parameters[0]/id</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="8b0b50fb-0d81-4cc4-83c2-54703bfd09cf"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result9eccbba9a94a4604a93003e7ed7f0591/date</from>
						<to>parameters[0]/modified</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="cc49b68d-0bbb-4209-b68b-b710681923f6"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result9eccbba9a94a4604a93003e7ed7f0591/date</from>
						<to>parameters[0]/secretModified</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="c1b0872a-3aef-480e-b08a-c92546f195b3"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>auditId</from>
						<to>transaction</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="0d609f5f-fdc6-446e-ade2-d3b8bdfda122"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result42b44e7e5a57486db157e449411713a3/hash</from>
						<to>parameters[0]/secret</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="6c1fa80c-df7f-4c45-97a9-f80e0b1ef352"
						serviceId="nabu.cms.core.utils.security.password.hash"
						resultName="result42b44e7e5a57486db157e449411713a3"
						temporaryMapping="true"
						x="338"
						y="120"
						invocationOrder="1"
						asynchronous="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="3dd35441-4b69-4694-a698-c964f46d3235"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result26d815b27f2841abb5ffb04fa433090b/uuid</from>
						<to>password</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="7a8cba99-6a01-4986-8f62-e90033be6ea6"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>user/salt</from>
						<to>salt</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="11c68833-813f-42f7-8754-d16b47ded732"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>user/algorithm</from>
						<to>algorithm</to>
					</steps>
				</steps>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Map the rest of the token"
				disabled="false"
				id="02b6aabfba8144ca852d51730777ab79">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="f39ade4d60f0465c917a710064a438bd"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/realm</from>
				<to>output/response/realm</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="fbf23e864fcd499f96faaa05808ae026"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>user/alias</from>
				<to>output/response/name</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="3b9b858afbcf4a6eac52f20f24bde74a"
					serviceId="nabu.authentication.oauth2.server.Services.toToken"
					resultName="resulteaad8b7c721c43de9c641145a4c5d25a"
					temporaryMapping="true"
					x="46"
					y="154"
					invocationOrder="0"
					asynchronous="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="9a9150da727b4481854e36f63863a781"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/credentials</from>
					<to>credentials</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="f6b4ae705b434cdd8b82aa61a008368b"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/realm</from>
					<to>realm</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="7868340e08924b16ae5dc9c3fda2950c"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>resulteaad8b7c721c43de9c641145a4c5d25a/token</from>
				<to>output/response/credentials[0]</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="3a63cd475c914daf92c71965a88f3628"
					serviceId="nabu.cms.core.database.node.audit.updateActor"
					resultName="result3a504993b0574b93bbfb314a82add3e5"
					temporaryMapping="true"
					x="53"
					y="285"
					invocationOrder="0"
					asynchronous="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="e2e33f87a0e647c48140238d7c358a1e"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>auditId</from>
					<to>parameters[0]/id</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="7d02d9829c7a408d97826f5eb52e734e"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>user/id</from>
					<to>parameters[0]/actorId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="4de639e3d023464596865c4baca5d564"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/configuration/connectionId</from>
					<to>connection</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="6c75d0b592184de2837b52bf4fb60a53"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>auditId</from>
					<to>transaction</to>
				</steps>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Catch"
				disabled="false"
				id="2c5bf50527bf42eca2741b5fe78cbec5"
				variable="exception">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					disabled="false"
					id="d54527d820d74a1aaa08a43037c151b1">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="96ecdd36176d46d6a0893f6d94ec4599"
						serviceId="nabu.cms.core.services.node.audit.error"
						resultName="resultf0058a1ba5fc4283b405f086eccb1e80"
						temporaryMapping="true"
						x="33"
						y="78"
						invocationOrder="0"
						asynchronous="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="510cb4a9649a40a7affe138826b16bd8"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>exception</from>
						<to>exception</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="ca004af1b5f84885bef5bba3dff873be"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/configuration/connectionId</from>
						<to>connectionId</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="80ea067f88b341cdb5ca2c6a25746fc1"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>auditId</from>
						<to>auditId</to>
					</steps>
				</steps>
			</steps>
		</steps>
	</steps>
</sequence>