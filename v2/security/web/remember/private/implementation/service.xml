<sequence xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		disabled="false"
		id="b68753f3-1fb8-4796-bdcc-d481f8e1490d"
		lineNumber="1">
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="672e503a-bb9b-478d-8e26-63eeca0d215d"
			lineNumber="2">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="6592c709-ed0c-4a46-8e03-885f67e54cfe"
				serviceId="nabu.utils.String.split"
				resultName="result193035c0f2294a95a9d6fb391705d4c7"
				temporaryMapping="true"
				x="159"
				y="140"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="f1f35afb-b38c-4ed6-bdcf-ed6553cd2936"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>:</from>
				<to>separator</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="39359417-9bfb-46f1-9650-1b40176d28c6"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/cookie/Remember</from>
				<to>string</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="cf2dff87-62df-4141-bd81-d169111a916a"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result193035c0f2294a95a9d6fb391705d4c7/parts[0]</from>
			<to>authentication/id</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="e225461a-842d-4071-83a4-8a4a02646060"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result193035c0f2294a95a9d6fb391705d4c7/parts[1]</from>
			<to>authentication/secret</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="8bb881d3-f1a1-4b98-8eee-0a26e4c46872"
				mask="false"
				optional="false"
				fixedValue="true">
			<from>true</from>
			<to>canLogin</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
			comment="If we can't go further, we assume you are anonymous"
			disabled="false"
			id="5703ad36-69d3-4dbe-894d-ef5197295c74"
			label="authentication/id == null || authentication/secret == null"
			lineNumber="3">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Add $guest"
				disabled="false"
				id="072236fa-b980-4a30-a818-38930774729e"
				lineNumber="4">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="5527d458-b410-43e6-bc18-18a6e33489b0"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>$guest</from>
				<to>output/content/roles[0]</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Break"
				comment="Fail gracefully"
				disabled="false"
				id="8dfe2b05-254c-4aa6-9d5f-a62e6c4bf8ba"
				lineNumber="5">
			<count>2</count>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
			disabled="false"
			id="f182e16e-edd9-493e-9cd7-b083be9dd815"
			lineNumber="6">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				disabled="false"
				id="5a0b914b-3b84-4867-8527-9ff1205a9928"
				lineNumber="7">
			<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
					disabled="false"
					id="bd5dccc0-1f5b-4f51-a2ca-67ca846047ed"
					path="authentication" xsi:nil="true"/>
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="1711daa6-db07-4ee9-9de1-db7bbaee6186"
					serviceId="nabu.web.application.Services.temporarilyAuthenticate"
					resultName="result605fa12863834226ae1ecd615548fe91"
					temporaryMapping="true"
					x="424"
					y="60"
					invocationOrder="1"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="50141e57-9153-4cef-9889-c141c7b0aefb"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>authentication</from>
					<to>authentication</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="c0fb080b-a248-4604-b39f-790de44aca6c"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>remember</from>
					<to>type</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="6e2d0148-6d4c-4b33-ad00-25620491e898"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/device</from>
					<to>device</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="1ac71f43-f78a-4b69-8cc6-4dca1d574b40"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/webApplicationId</from>
					<to>webApplicationId</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="cb920204-7241-4ed7-b583-3513a59134be"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result605fa12863834226ae1ecd615548fe91/response</from>
				<to>token</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Catch"
				comment="If we can't authenticate, we need to unset the remember"
				disabled="false"
				id="127c0a74-2d21-4fb9-af1b-3858a28cb330"
				lineNumber="8">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Drop the authentication"
					disabled="false"
					id="346d10d4-55db-49ad-bec1-e78a05a2c058"
					lineNumber="9">
				<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
						disabled="false"
						id="3873bb23-b4d5-4af5-8334-7e1441ac377c"
						path="authentication" xsi:nil="true"/>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="15413479-f47e-44d0-b707-953d587b5cc1"
			label="token/authenticationId != null"
			lineNumber="10">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="e54b15e3-8295-48b6-8417-ba261a1757c5"
				serviceId="nabu.cms.core.services.user.canLoginAs"
				resultName="result41dd2075ac784c24b287c1ee585f7a35"
				temporaryMapping="true"
				x="81"
				y="36"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="e1a4d211-e961-4b95-8ae7-7573f577c2d6"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>token/authenticationId</from>
				<to>userId</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="0aa79cb4-da23-44b5-974c-9e2da58bc9b2"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result41dd2075ac784c24b287c1ee585f7a35/canLogin</from>
			<to>canLogin</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Throw"
			comment="If you are not allowed to log in, stop"
			disabled="false"
			id="0b6afbb5-76a9-4b75-87cd-0039f03ae17c"
			label="!canLogin"
			lineNumber="11"
			code="403" xsi:nil="true"/>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="If we successfully authenticated, create a new temporary authentication to serve as opaque token"
			disabled="false"
			id="23aae063-5611-441c-b8ba-81646fc2e4e9"
			label="token"
			lineNumber="12">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="3f76f2e0-d31f-4ef6-8cdc-96eee2c8d4e9"
				serviceId="nabu.web.application.Services.newTemporaryAuthentication"
				resultName="result38fdba2a82f3472bb37630b2fef0e2a5"
				temporaryMapping="true"
				x="530"
				y="83"
				invocationOrder="1"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="74c6ffc7-2cf9-49b8-aa7d-d00c430b735c"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>opaqueToken</from>
				<to>type</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="8e5ebf0c-0b52-4db0-adf5-37bc13a00999"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>token/name</from>
				<to>alias</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="09d51b91-8e51-48fb-b912-38f09a834656"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>resulte12d61efd27f480cb26876e13ac96e54/date</from>
				<to>until</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="b3699769-e579-417b-ac20-2eb66c3d5f46"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>PT30M</from>
				<to>timeout</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="136ccce2-9980-44d0-9a0e-4bea2c07b884"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>token/authenticationId</from>
				<to>authenticationId</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="4ed79eda-aad8-4da6-9457-bb1dd5ccc57b"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/device</from>
				<to>device</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="39dcac1f-751a-49d6-80e9-bda38f1b952d"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/webApplicationId</from>
				<to>webApplicationId</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="3a735d3d-9f01-47c0-ab95-0695536adc51"
				serviceId="nabu.utils.Date.incrementDuration"
				resultName="resulte12d61efd27f480cb26876e13ac96e54"
				temporaryMapping="true"
				x="114"
				y="305"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="3d596450-37c4-4f84-8597-325c51d966c9"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>P1D</from>
				<to>duration</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="27bb6536-14c8-4da1-94cc-7ab4754e29b8"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result38fdba2a82f3472bb37630b2fef0e2a5/authentication</from>
			<to>authentication</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Set the token"
			disabled="false"
			id="609602c6-1501-4466-b0a7-e5c8f7ea0da7"
			label="authentication"
			lineNumber="13">
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="aca3a036-8c4e-41d5-8a24-3923f586b6c3"
				mask="false"
				optional="false"
				fixedValue="true">
			<from>=authentication/id + ":" + authentication/secret</from>
			<to>output/content/token</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="9f102dc2-7664-4715-853b-af401c873e9e"
			label="token"
			lineNumber="14">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="7bad8fb7-e370-4371-9c38-dd656d379083"
				serviceId="nabu.web.application.Services.newTemporaryAuthentication"
				resultName="resultbd704e4d461b47d2b1d09c9951965ff7"
				temporaryMapping="true"
				x="559"
				y="66"
				invocationOrder="1"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="ec33928a-2fa8-4e69-ab67-9765a3f569b9"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>remember</from>
				<to>type</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="fd47c34f-6b27-4121-975e-7bbb998de07f"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>token/name</from>
				<to>alias</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="f58b5298-6010-4678-a904-2772050b02c1"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>token/authenticationId</from>
				<to>authenticationId</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="40c28128-3c49-4281-b34e-5a30658b2630"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result9aa9606ef5e74c0997bb3602bcfbe337/date</from>
				<to>until</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="fb13d3f1-6729-4d2e-92e3-edb7b4737939"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>1</from>
				<to>maxUses</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="fdbf9161-df3e-4fab-bc28-785da46aa261"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/device</from>
				<to>device</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="567f02c2-a611-4343-946e-09afda1f9bf5"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/webApplicationId</from>
				<to>webApplicationId</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="c1694a74-af40-4f07-a6f7-1509edb01b69"
				serviceId="nabu.utils.Date.incrementDuration"
				resultName="result9aa9606ef5e74c0997bb3602bcfbe337"
				temporaryMapping="true"
				x="51"
				y="312"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="d36d445a-6c57-4e2b-a4a3-ece66597af59"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>P1Y</from>
				<to>duration</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="daefb478-372d-495b-84e5-70fd22159aa6"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>resultbd704e4d461b47d2b1d09c9951965ff7/authentication</from>
			<to>authentication</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="bb9d888a-40cd-4eb4-9659-4854cf61614e"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result9aa9606ef5e74c0997bb3602bcfbe337/date</from>
			<to>expires</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
			comment="Update remember cookie if needed"
			disabled="false"
			id="242c8df8-ad70-46f1-8953-bfb5f01b2404"
			lineNumber="15">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				disabled="false"
				id="a39cee48-849d-4ef7-a0c5-94d427a72428"
				label="authentication"
				lineNumber="16">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="272b0892-e80f-4286-a7b0-0009bdd2e453"
					serviceId="nabu.web.application.Services.formatCookie"
					resultName="result9cb5728e344f47af8f4d9a5a93fc8bd1"
					temporaryMapping="true"
					x="434"
					y="123"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="fde1a56e-ae56-47ed-ab3d-1e9950c6b0eb"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>Remember</from>
					<to>key</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="dd97bc71-2fd2-4aeb-9982-797bb3946002"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>=authentication/id + ":" + authentication/secret</from>
					<to>value</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="30bcdaf5-b6f0-4f1b-9e5a-b740ea568d60"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>expires</from>
					<to>expires</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="ec5a6058-a162-4cab-a84a-1f4d9fc70945"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/webApplicationId</from>
					<to>webApplicationId</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="0e7e8fd0-5de5-4ff9-88b8-17eeb1da04c9"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result9cb5728e344f47af8f4d9a5a93fc8bd1/cookie</from>
				<to>output/header/setCookie</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="If we can't remember and we have a cookie, forget it"
				disabled="false"
				id="6c9490efb17b4b4387eef3215a61232d"
				label="input/cookie/Remember != null"
				lineNumber="17">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="9026ba08a4aa4ea3827d4d59138a187e"
					serviceId="nabu.web.application.Services.formatCookie"
					resultName="result9cb5728e344f47af8f4d9a5a93fc8bd1"
					temporaryMapping="true"
					x="434"
					y="123"
					invocationOrder="1"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="6316a97464c8449e8d3a9c68949a985c"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>Remember</from>
					<to>key</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="5397d62e6abf4afc9d37fc6c4275cc1a"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>forgotten</from>
					<to>value</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="e5d5f25f-39b6-46bc-95a0-38b70efce468"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result43b28b9850a6408483e5f6d77a072b3f/date</from>
					<to>expires</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="37ac0730-f694-4ba6-ab4d-66b595645f5f"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/webApplicationId</from>
					<to>webApplicationId</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="d1035125ba70447e935027cbbab9ce57"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result9cb5728e344f47af8f4d9a5a93fc8bd1/cookie</from>
				<to>output/header/setCookie</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="3f10e8a5-8d26-40a4-90de-4b1524a56f97"
					serviceId="nabu.utils.Date.incrementDuration"
					resultName="result43b28b9850a6408483e5f6d77a072b3f"
					temporaryMapping="true"
					x="56"
					y="203"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="92935074-4443-4857-9513-e35eaa492ac5"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>-1</from>
					<to>times</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="255ba230-70a5-4f1d-91e5-11ea192470e0"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>P1D</from>
					<to>duration</to>
				</steps>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
			disabled="false"
			id="d94fb19b-163c-4cc7-b998-51d3deb96aa4"
			label="output/content/token != null &amp;&amp; token/authenticationId != null"
			lineNumber="18">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Get the node for this (presumably) user"
				disabled="false"
				id="64f9e8e9-b28e-445f-86dc-47a80bf3aec6"
				lineNumber="19">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="ab544db2-4feb-4a95-8de8-cf5a8cd74ce0"
					serviceId="nabu.cms.core.crud.node.services.get"
					resultName="result91483f1a100c47adbbbd006515a71d55"
					temporaryMapping="true"
					x="124"
					y="27"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="a2ca82a9-6ad5-4417-af45-22c2efb9ec8b"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>token/authenticationId</from>
					<to>id</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="feaa0914-c79d-4671-897c-4e42b81954c7"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result91483f1a100c47adbbbd006515a71d55/result</from>
				<to>node</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Get the language set for this user (if any)"
				disabled="false"
				id="d396098d-4046-459d-adda-fbee3933ab92"
				label="node/languageId != null"
				lineNumber="20">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="ff37d857-3443-4c7d-b5c6-e7e55d54693b"
					serviceId="nabu.cms.core.crud.masterDataEntry.services.get"
					resultName="resultd2c5031c5d35464e800d6b24fc85cfd4"
					temporaryMapping="true"
					x="61"
					y="50"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="3d6878de-5295-4480-a04c-30cea52f948b"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>node/languageId</from>
					<to>id</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="b996ba9f-5f7e-4065-b1d9-ef5d0863aa8d"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>resultd2c5031c5d35464e800d6b24fc85cfd4/result/name</from>
				<to>output/content/language</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
				comment="If we have a device, make sure it is registered to this user"
				disabled="false"
				id="98138971-a97d-4b78-823a-3ead1312c1bf"
				label="input/device/deviceId != null"
				lineNumber="21">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					disabled="false"
					id="5bf99cad-7583-4c24-a6fb-ce87ece19f98"
					lineNumber="22">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="319eeb3a-256d-4f67-99d4-52cc039efd2f"
						serviceId="nabu.cms.core.crud.userDevice.services.list"
						resultName="result4db1c442af2d4f0e8d5ebe5a51831f84"
						temporaryMapping="true"
						x="186"
						y="75"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="0be1d2db-c9ea-4e22-8128-5ead1d804432"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>token/authenticationId</from>
						<to>filter/userId[0]</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="9a7bd176-1316-4b8b-a2f4-3f92f0d6be9e"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/device/deviceId</from>
						<to>filter/deviceId[0]</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="85671c15-6951-43c9-86fe-79b0b2cd6509"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result4db1c442af2d4f0e8d5ebe5a51831f84/results[0]</from>
					<to>currentDevice</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
					disabled="false"
					id="121033ef-4c9a-4044-a327-c9e9b4fb52ca"
					lineNumber="23">
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="If device is not yet known, create it"
						disabled="false"
						id="1c5dd030-af0c-476a-9f6c-df19bc75b711"
						label="!currentDevice"
						lineNumber="24">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="f15927fb-219a-4a0b-8c9f-768ffaed815b"
							serviceId="nabu.cms.core.crud.userDevice.services.create"
							resultName="resulte0838bc91c074007af9beff7f24faf2f"
							temporaryMapping="true"
							x="520"
							y="55"
							invocationOrder="1"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="b84c5da7-3431-4388-8d03-b7ac8de5bc32"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>true</from>
							<to>instance/allowed</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="8b1c397d-1e86-48a4-a501-40bbfc86bd2f"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>resultab20f9a9ad83440fa4687e24886020bf/name</from>
							<to>instance/name</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="2a1096d3-8d51-4122-a2d5-066cd25f1dcd"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>input/device/deviceDescription</from>
							<to>instance/description</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="06e42b52-b6ad-4482-bd22-4899f9de74a6"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>input/device/deviceId</from>
							<to>instance/deviceId</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="bd884fba-81bc-44e1-985c-01761aecfa78"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>token/authenticationId</from>
							<to>instance/userId</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="f0e2cf79-8bd7-40bf-ad64-ecaea3c71b28"
							serviceId="nabu.cms.core.utils.security.guessDeviceName"
							resultName="resultab20f9a9ad83440fa4687e24886020bf"
							temporaryMapping="true"
							x="75"
							y="130"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="161020a8-058c-4333-9e71-1b783a4de638"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>input/device/deviceDescription</from>
							<to>deviceDescription</to>
						</steps>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="If this device is explicitly not allowed, drop output"
						disabled="false"
						id="529782a1-c7cf-40ca-8f17-73ebb70ed702"
						label="currentDevice/allowed == false"
						lineNumber="25">
					<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
							disabled="false"
							id="b2f9f3ba-d09f-44e0-b1c9-3ef3f0a2588a"
							path="output/content" xsi:nil="true"/>
				</steps>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="70513f81-7fc6-496d-b93b-7be2cd9c79b3"
			lineNumber="26">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="70aef0a8-dc38-42f9-92d2-468b7338286e"
				serviceId="nabu.cms.core.services.security.getPotentialSecurity"
				resultName="resultb7eabf7a49f24640ad89d6713210174e"
				temporaryMapping="true"
				x="66"
				y="52"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="2d585488-aa2b-4b2e-b726-9561ae7450a1"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>token/authenticationId</from>
				<to>userId</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="5f48baf3-dd60-41cd-826d-d8e478b2ce3a"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>resultb7eabf7a49f24640ad89d6713210174e/roles</from>
			<to>output/content/roles</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="0430c8e0-2a00-4e9d-b8ad-c04374563dc9"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>resultb7eabf7a49f24640ad89d6713210174e/permissions</from>
			<to>output/content/permissions</to>
		</steps>
	</steps>
</sequence>