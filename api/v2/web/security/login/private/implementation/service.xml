<sequence xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		disabled="false"
		id="9b95c2ec-6ba2-4347-8fa2-1c6d56efcc66"
		lineNumber="1">
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Authenticate in the application"
			disabled="false"
			id="40adda89-e18c-417c-b034-51456d254f50"
			lineNumber="2">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="f25fd09c-c65a-4f13-bfcf-7b27501a381b"
				serviceId="nabu.web.application.Services.authenticate"
				resultName="resultc6f0745d9832479bb19c087cdcdc9913"
				temporaryMapping="true"
				x="465"
				y="132"
				invocationOrder="1"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="3bae8e8a-ed9b-4db6-b10e-7b62139701dd"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result3086ab2dc24d401091640e0e8cf2f5a2/current/id</from>
				<to>webApplicationId</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="acb8f8d9-6901-43b9-aa97-8d42ea5a3fec"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/content/type</from>
				<to>type</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="8bc04427-fb27-4e7e-9387-09f0d685f15f"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/content/secret</from>
				<to>password</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="12b58a11-6bef-4639-b9b8-10065a71d861"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/content/authenticationId</from>
				<to>alias</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="83b647c6-97f2-4916-9db9-b233f4cd6c0c"
				serviceId="nabu.web.application.Services.current"
				resultName="result3086ab2dc24d401091640e0e8cf2f5a2"
				temporaryMapping="true"
				x="25"
				y="46"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="83e69494-9159-4783-8d03-65d8748d76c9"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>resultc6f0745d9832479bb19c087cdcdc9913/token</from>
			<to>token</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="69533232-16c1-4df7-8f3d-2f7977aa31ff"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result3086ab2dc24d401091640e0e8cf2f5a2/current</from>
			<to>current</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="If we successfully authenticated, create a new temporary authentication to serve as opaque token"
			disabled="false"
			id="23aae063-5611-441c-b8ba-81646fc2e4e9"
			label="token"
			lineNumber="3">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="3f76f2e0-d31f-4ef6-8cdc-96eee2c8d4e9"
				serviceId="nabu.web.application.Services.newTemporaryAuthentication"
				resultName="result38fdba2a82f3472bb37630b2fef0e2a5"
				temporaryMapping="true"
				x="530"
				y="83"
				invocationOrder="1"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="74c6ffc7-2cf9-49b8-aa7d-d00c430b735c"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>opaqueToken</from>
				<to>type</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="8e5ebf0c-0b52-4db0-adf5-37bc13a00999"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>token/name</from>
				<to>alias</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="1d3c8351-3093-4274-804b-5d2719bf0d74"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>current/id</from>
				<to>webApplicationId</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="09d51b91-8e51-48fb-b912-38f09a834656"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>resulte12d61efd27f480cb26876e13ac96e54/date</from>
				<to>until</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="b3699769-e579-417b-ac20-2eb66c3d5f46"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>PT30M</from>
				<to>timeout</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="136ccce2-9980-44d0-9a0e-4bea2c07b884"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>token/authenticationId</from>
				<to>authenticationId</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="81fe9ddf-30ae-406f-a0a3-c074a77bccca"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/device</from>
				<to>device</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="3a735d3d-9f01-47c0-ab95-0695536adc51"
				serviceId="nabu.utils.Date.incrementDuration"
				resultName="resulte12d61efd27f480cb26876e13ac96e54"
				temporaryMapping="true"
				x="114"
				y="305"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="3d596450-37c4-4f84-8597-325c51d966c9"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>P1D</from>
				<to>duration</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="27bb6536-14c8-4da1-94cc-7ab4754e29b8"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result38fdba2a82f3472bb37630b2fef0e2a5/authentication</from>
			<to>authentication</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Set the token"
			disabled="false"
			id="609602c6-1501-4466-b0a7-e5c8f7ea0da7"
			label="authentication"
			lineNumber="4">
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="aca3a036-8c4e-41d5-8a24-3923f586b6c3"
				mask="false"
				optional="false"
				fixedValue="true">
			<from>=authentication/id + ":" + authentication/secret</from>
			<to>output/content/token</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
			comment="If we want to be remembered, we need to generate a secret that can be read again. We also want to link it to the device."
			disabled="false"
			id="f528eb3f-0aee-47c1-8b49-2e2c2933dbd6"
			label="input/query/remember &amp;&amp; input/device/deviceId != null"
			lineNumber="5">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				disabled="false"
				id="9f102dc2-7664-4715-853b-af401c873e9e"
				lineNumber="6">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="7bad8fb7-e370-4371-9c38-dd656d379083"
					serviceId="nabu.web.application.Services.newTemporaryAuthentication"
					resultName="resultbd704e4d461b47d2b1d09c9951965ff7"
					temporaryMapping="true"
					x="559"
					y="66"
					invocationOrder="1"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="ec33928a-2fa8-4e69-ab67-9765a3f569b9"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>remember</from>
					<to>type</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="fd47c34f-6b27-4121-975e-7bbb998de07f"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>token/name</from>
					<to>alias</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="f58b5298-6010-4678-a904-2772050b02c1"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>token/authenticationId</from>
					<to>authenticationId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="40c28128-3c49-4281-b34e-5a30658b2630"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result9aa9606ef5e74c0997bb3602bcfbe337/date</from>
					<to>until</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="fb13d3f1-6729-4d2e-92e3-edb7b4737939"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>1</from>
					<to>maxUses</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="3e14f6cd-8253-428a-9861-a0af5431e190"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>current/id</from>
					<to>webApplicationId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="718c91ff-3d54-401b-8c72-94c8b3f4af38"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/device</from>
					<to>device</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="c1694a74-af40-4f07-a6f7-1509edb01b69"
					serviceId="nabu.utils.Date.incrementDuration"
					resultName="result9aa9606ef5e74c0997bb3602bcfbe337"
					temporaryMapping="true"
					x="51"
					y="312"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="d36d445a-6c57-4e2b-a4a3-ece66597af59"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>P1Y</from>
					<to>duration</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="daefb478-372d-495b-84e5-70fd22159aa6"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>resultbd704e4d461b47d2b1d09c9951965ff7/authentication</from>
				<to>authentication</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="ad9770dc-05d7-4082-9323-d1bb1d8f1fde"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result9aa9606ef5e74c0997bb3602bcfbe337/date</from>
				<to>expires</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				disabled="false"
				id="a39cee48-849d-4ef7-a0c5-94d427a72428"
				label="authentication"
				lineNumber="7">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="272b0892-e80f-4286-a7b0-0009bdd2e453"
					serviceId="nabu.web.application.Services.formatCookie"
					resultName="result9cb5728e344f47af8f4d9a5a93fc8bd1"
					temporaryMapping="true"
					x="434"
					y="123"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="b502b25e-cf12-4e26-a6a6-6acdbd532e88"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>current/id</from>
					<to>webApplicationId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="be5987bd-e7f0-4857-9d93-929c76261849"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>expires</from>
					<to>expires</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="fde1a56e-ae56-47ed-ab3d-1e9950c6b0eb"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>Remember</from>
					<to>key</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="dd97bc71-2fd2-4aeb-9982-797bb3946002"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>=authentication/id + ":" + authentication/secret</from>
					<to>value</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="0e7e8fd0-5de5-4ff9-88b8-17eeb1da04c9"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result9cb5728e344f47af8f4d9a5a93fc8bd1/cookie</from>
				<to>output/header/setCookie</to>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
			comment="If we are logging in and have a remember cookie, we need to invalidate it"
			disabled="false"
			id="3766a887-be1e-4d21-8444-8ec069276365"
			label="input/cookie/Remember != null"
			lineNumber="8">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				disabled="false"
				id="2351da6a-7acb-4477-b63b-d06879709e20"
				lineNumber="9">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="e04b2144-65ce-4fb7-b633-545fe88de0b9"
					serviceId="nabu.utils.String.split"
					resultName="resultd2556cd250ee4ebbba24551dabae46e7"
					temporaryMapping="true"
					x="139"
					y="48"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="37f337d6-521d-4400-9783-fd9181438674"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/cookie/Remember</from>
					<to>string</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="8d3e51a6-f959-4c4d-8c9c-b065ad5d594d"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>:</from>
					<to>separator</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="80433413-7b05-43bf-b725-38a5ef4eb50f"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>resultd2556cd250ee4ebbba24551dabae46e7/parts[1]</from>
				<to>authentication/secret</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="ae563b36-0a98-4b5c-a56d-a3b7a4541229"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>resultd2556cd250ee4ebbba24551dabae46e7/parts[0]</from>
				<to>authentication/id</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Invalidate by using it"
				disabled="false"
				id="7bf10a4e-0a20-4faf-93ed-cb7feec1581b"
				label="authentication/id != null &amp;&amp; authentication/secret != null"
				lineNumber="10">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="8f6d9cf4-adc5-4904-9de4-1cd0b4db8ed2"
					serviceId="nabu.web.application.Services.temporarilyAuthenticate"
					resultName="result6cf5865a3087499b8bc1a5193e199308"
					temporaryMapping="true"
					x="138"
					y="52"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="a9a25312-3808-4855-88b3-cd8a40a7030b"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>current/id</from>
					<to>webApplicationId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="79e4f36d-cec5-47c6-b858-7a411ecd95ba"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>authentication</from>
					<to>authentication</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="282689e1-ed82-4aa3-8b06-7c294f2b0315"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>remember</from>
					<to>type</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="06a1dd18-20dc-4f48-a2d8-852e0ea0573e"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/device</from>
					<to>device</to>
				</steps>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Catch"
				comment="It is possible that the remember is not valid. We don't want the whole login to fail at that point"
				disabled="false"
				id="48515a86-9eb4-4609-9dfc-4da13c865dbc"
				lineNumber="11"
				suppressException="true">
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Finally"
				disabled="false"
				id="8ff0464f-8911-4bc6-a1d4-dd699dd05fcc"
				lineNumber="12">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="If we don't have a cookie by now, we want to forget the one there is"
					disabled="false"
					id="fb5c5272bd4c4073b15e00deccab5966"
					label="output/header/setCookie == null"
					lineNumber="13">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="821ff930b29649b3b34186adfcfc169c"
						serviceId="nabu.web.application.Services.formatCookie"
						resultName="result9cb5728e344f47af8f4d9a5a93fc8bd1"
						temporaryMapping="true"
						x="434"
						y="123"
						invocationOrder="1"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="93ade06496004f72b156d23e096741fd"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>current/id</from>
						<to>webApplicationId</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="55d558fc39bd4c288936ad2e2c537a7f"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>Remember</from>
						<to>key</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="bea3f99239e44471b2a8ff68e4fafe98"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>forgotten</from>
						<to>value</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="12ee7177-bda4-4339-8b13-33ddd6acaf45"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result4fae7870ca5d45d5bd02732daf887c62/date</from>
						<to>expires</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="7d648a69702841308bed560017cb33f5"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result9cb5728e344f47af8f4d9a5a93fc8bd1/cookie</from>
					<to>output/header/setCookie</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="17367445-edb4-4eb8-9dde-ba995154309e"
						serviceId="nabu.utils.Date.incrementDuration"
						resultName="result4fae7870ca5d45d5bd02732daf887c62"
						temporaryMapping="true"
						x="96"
						y="247"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="5ff5011b-b651-464e-91f1-5fbb7107db1e"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>-1</from>
						<to>times</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="9a4e0a4c-1adb-433e-92dc-3319da6c32b4"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>P1D</from>
						<to>duration</to>
					</steps>
				</steps>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
			comment="If we are a valid user, let's also include the roles and permissions you potentially have access to"
			disabled="false"
			id="d94fb19b-163c-4cc7-b998-51d3deb96aa4"
			label="output/content/token != null &amp;&amp; token/authenticationId != null"
			lineNumber="14">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Get the node for this (presumably) user"
				disabled="false"
				id="64f9e8e9-b28e-445f-86dc-47a80bf3aec6"
				lineNumber="15">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="ab544db2-4feb-4a95-8de8-cf5a8cd74ce0"
					serviceId="nabu.cms.core.crud.node.services.get"
					resultName="result91483f1a100c47adbbbd006515a71d55"
					temporaryMapping="true"
					x="124"
					y="27"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="a2ca82a9-6ad5-4417-af45-22c2efb9ec8b"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>token/authenticationId</from>
					<to>id</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="6d4cc0d3-9bf2-4de6-9f0d-d763ce5cb73d"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result91483f1a100c47adbbbd006515a71d55/result</from>
				<to>node</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				disabled="false"
				id="53d3051e-fbb1-471f-9ac3-40b10dd90708"
				label="node"
				lineNumber="16">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="e5691439-c441-4220-8632-2964dcf7f833"
					serviceId="nabu.cms.core.database.user.selectPotentialRoles"
					resultName="result53bac97269bb4a72ac4651687fda73e5"
					temporaryMapping="true"
					x="138"
					y="37"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="843aefae-02ec-4645-a3b0-775f5dfa5220"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>token/authenticationId</from>
					<to>parameters/userId</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="86559db0-0b28-40ba-aeb2-0b27484ce695"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result53bac97269bb4a72ac4651687fda73e5/results/name</from>
				<to>output/content/roles</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				disabled="false"
				id="9a327171-dc0d-4df0-a00a-de2c9445dcb1"
				label="node"
				lineNumber="17">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="a84331b8-cff2-4396-af09-ccc1eea237bd"
					serviceId="nabu.cms.core.database.user.selectPotentialActions"
					resultName="result70dbd37e3eff4ad4a3fbaf4e8ccef608"
					temporaryMapping="true"
					x="169"
					y="65"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="4c60cfaa-c8ba-415d-853b-96e4e96e2414"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>token/authenticationId</from>
					<to>parameters/userId</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="b917030d-9d1b-43af-8645-5b66b907538b"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result70dbd37e3eff4ad4a3fbaf4e8ccef608/results/name</from>
				<to>output/content/permissions</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Get the language set for this user (if any)"
				disabled="false"
				id="d396098d-4046-459d-adda-fbee3933ab92"
				label="node/languageId != null"
				lineNumber="18">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="ff37d857-3443-4c7d-b5c6-e7e55d54693b"
					serviceId="nabu.cms.core.crud.masterDataEntry.services.get"
					resultName="resultd2c5031c5d35464e800d6b24fc85cfd4"
					temporaryMapping="true"
					x="61"
					y="50"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="a904bb4a-740a-404b-b647-027f615eb80b"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>node/languageId</from>
					<to>id</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="b996ba9f-5f7e-4065-b1d9-ef5d0863aa8d"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>resultd2c5031c5d35464e800d6b24fc85cfd4/result/name</from>
				<to>output/content/language</to>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
			comment="Set basic role"
			disabled="false"
			id="a909e248-136c-4e71-ba4e-d81564a52724"
			lineNumber="19">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Add $user as most basic role if the login was successful"
				disabled="false"
				id="58fbf90d-a971-4ea4-929a-7a4f6b5addad"
				label="output/content/token != null"
				lineNumber="20">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="2f609b65-2988-4196-b93d-22be0c96bdbd"
					serviceId="nabu.utils.List.add"
					resultName="result128834c8b1614319b1c9033cda1610b9"
					temporaryMapping="true"
					x="86"
					y="48"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="583ede49-24a4-425c-a57e-d105c426c3d1"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>output/content/roles</from>
					<to>list</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="d7dd407d-ee08-41a8-8680-40d12fce122b"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>$user</from>
					<to>object</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="214fb1fb-b006-49c3-ad0f-4a9b60f7e00f"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result128834c8b1614319b1c9033cda1610b9/list</from>
				<to>output/content/roles</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="bc1bc21e-87a0-4120-a0ae-70a9c9ab37c4"
					serviceId="nabu.cms.core.database.action.selectByRoleName"
					resultName="result3b686971eb0b4ace8693277a8c2a878b"
					temporaryMapping="true"
					x="87"
					y="196"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="af9a90d6-80a6-463a-94a1-72b68b236689"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>$user</from>
					<to>parameters/roleName</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="a75e6b5a-3dbb-4af7-b99b-71039e2b38a3"
					serviceId="nabu.utils.List.addAll"
					resultName="result380babbd70ba43bc83ff4f09b0e68ef8"
					temporaryMapping="true"
					x="526"
					y="184"
					invocationOrder="1"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="ec4e1abb-a242-4038-a59e-a176027f3ac1"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result3b686971eb0b4ace8693277a8c2a878b/results/name</from>
					<to>objects</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="e7d92df5-98a2-444b-91ac-315a9d95b584"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>output/content/permissions</from>
					<to>list</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="5c4717ef-1cbf-4fa6-bfd5-7d26e732ee61"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result380babbd70ba43bc83ff4f09b0e68ef8/list</from>
				<to>output/content/permissions</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Set $guest and any permissions that come with it"
				disabled="false"
				id="16043f5c-f02a-41e4-b09a-14f6a240bbb8"
				lineNumber="21">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="d8cf7fd6-52be-49ba-a68c-3f0e212c784e"
					serviceId="nabu.cms.core.database.action.selectByRoleName"
					resultName="resultf4ecf28a4f7b42e7a3eb3ce5f37a4b89"
					temporaryMapping="true"
					x="56"
					y="35"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="72527068-b670-4a8d-ad70-af44d368b630"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>$guest</from>
					<to>parameters/roleName</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="e6a42225-8c66-4d80-9c9b-4d950c6b1d72"
					serviceId="nabu.utils.List.add"
					resultName="result153e093538ee4906aa77536803904d8a"
					temporaryMapping="true"
					x="88"
					y="305"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="4388c60a-7513-43b4-81e5-db4561cf4aad"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>output/content/roles</from>
					<to>list</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="d4668f70-5a7d-4230-8db6-8d4eb1819103"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>$guest</from>
					<to>object</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="220c4d9b-ebce-4863-91a8-d5c636bfe2b6"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result153e093538ee4906aa77536803904d8a/list</from>
				<to>output/content/roles</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="7d01faa0-db7f-4a26-ab4a-c906bdb9c77c"
					serviceId="nabu.utils.List.addAll"
					resultName="resultfce603577c174a008f97b9a36020a275"
					temporaryMapping="true"
					x="556"
					y="74"
					invocationOrder="1"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="29a17491-a37f-4166-aa7c-2b2defae7e2c"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>output/content/permissions</from>
					<to>list</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="1e877265-fa47-41fb-8a83-cf5fb7162f4d"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>resultf4ecf28a4f7b42e7a3eb3ce5f37a4b89/results/name</from>
					<to>objects</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="b5240472-51a4-4f91-b2ed-992257107151"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>resultfce603577c174a008f97b9a36020a275/list</from>
				<to>output/content/permissions</to>
			</steps>
		</steps>
	</steps>
</sequence>